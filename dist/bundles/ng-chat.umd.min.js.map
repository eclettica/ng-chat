{"version":3,"sources":["../../node_modules/tslib/tslib.es6.js","ng://ng-chat/ng-chat/core/message-type.enum.ts","ng://ng-chat/ng-chat/core/chat-adapter.ts","ng://ng-chat/ng-chat/core/chat-participant-status.enum.ts","ng://ng-chat/ng-chat/core/chat-participant-type.enum.ts","ng://ng-chat/ng-chat/core/message.ts","ng://ng-chat/ng-chat/core/theme.enum.ts","ng://ng-chat/ng-chat/core/user.ts","ng://ng-chat/ng-chat/core/participant-response.ts","ng://ng-chat/ng-chat/core/participant-metadata.ts","ng://ng-chat/ng-chat/core/window.ts","ng://ng-chat/ng-chat/core/paged-history-chat-adapter.ts","ng://ng-chat/ng-chat/core/scroll-direction.enum.ts","ng://ng-chat/ng-chat/core/window-option.ts","ng://ng-chat/ng-chat/core/window-button.ts","ng://ng-chat/ng-chat/core/guid.ts","ng://ng-chat/ng-chat/core/group.ts","ng://ng-chat/ng-chat/core/default-file-upload-adapter.ts","ng://ng-chat/ng-chat/ng-chat.component.ts","ng://ng-chat/ng-chat/pipes/emojify.pipe.ts","ng://ng-chat/ng-chat/pipes/linkfy.pipe.ts","ng://ng-chat/ng-chat/pipes/sanitize.pipe.ts","ng://ng-chat/ng-chat/pipes/secure.pipe.ts","ng://ng-chat/ng-chat/pipes/group-message-display-name.pipe.ts","ng://ng-chat/ng-chat/components/ng-chat-options/ng-chat-options.component.ts","ng://ng-chat/ng-chat/components/ng-chat-window-options/ng-chat-window-options.component.ts","ng://ng-chat/ng-chat/core/message-counter.ts","ng://ng-chat/ng-chat/core/chat-participant-status-descriptor.ts","ng://ng-chat/ng-chat/components/ng-chat-friends-list/ng-chat-friends-list.component.ts","ng://ng-chat/ng-chat/components/ng-chat-window/ng-chat-window.component.ts","ng://ng-chat/ng-chat/ng-chat.module.ts"],"names":["extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__decorate","decorators","target","key","desc","c","arguments","length","r","getOwnPropertyDescriptor","Reflect","decorate","i","defineProperty","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","__generator","body","f","y","t","g","_","label","sent","trys","ops","verb","throw","return","Symbol","iterator","this","n","v","op","TypeError","call","pop","push","MessageType","ChatAdapter","friendsListChangedHandler","participantsResponse","messageReceivedHandler","participant","message","prototype","onFriendsListChanged","onMessageReceived","ChatParticipantStatus","ChatParticipantType","type","Text","Theme","participantType","User","totalUnreadMessages","isLoadingHistory","isCollapsed","messages","newMessage","hasFocus","hasMoreMessages","historyPage","PagedHistoryChatAdapter","__","constructor","create","__extends","_super","ScrollDirection","Guid","newGuid","replace","Math","random","toString","participants","id","Group","windowOptions","chattingTo","status","Online","displayName","map","sort","first","second","join","DefaultFileUploadAdapter","_serverEndpointUrl","_http","uploadFile","file","participantId","formData","FormData","append","name","post","NgChat","_httpClient","_isDisabled","maximizeWindowOnNewMessage","pollFriendsList","pollingInterval","historyEnabled","emojisEnabled","linkfyEnabled","audioEnabled","searchEnabled","audioSource","persistWindowsState","title","messagePlaceholder","searchPlaceholder","browserNotificationsEnabled","browserNotificationIconSource","browserNotificationTitle","historyPageSize","hideFriendsList","hideFriendsListOnUnsupportedViewport","theme","Light","messageDatePipeFormat","showMessageDate","isViewportOnMobileEnabled","onParticipantClicked","EventEmitter","onParticipantChatOpened","onParticipantChatClosed","onMessagesSeen","browserNotificationsBootstrapped","hasPagedHistory","statusDescription","online","busy","away","offline","participantsInteractedWith","windowSizeFactor","friendsListWidth","unsupportedViewport","windows","isBootstrapped","window","clearInterval","pollingIntervalWindowInstance","activateFriendListFetch","userId","ngOnInit","bootstrapChat","onResize","event","viewPortTotalArea","innerWidth","NormalizeWindows","maxSupportedOpenedWindows","floor","difference","splice","updateWindowsState","_this","initializationException","adapter","initializeTheme","initializeDefaultText","initializeBrowserNotifications","msg","bufferAudioFile","fileUploadUrl","fileUploadAdapter","ex","console","error","fetchFriendsList","setInterval","Notification","requestPermission","_a","localization","loadMessageHistoryPlaceholder","customTheme","Custom","Dark","Error","isBootstrapping","listFriends","pipe","response","subscribe","restoreWindowsState","fetchMessageHistory","getMessageHistoryByPage","forEach","assertMessageType","concat","direction","Bottom","Top","setTimeout","onFetchMessageHistoryLoaded","getMessageHistory","forceMarkMessagesAsSeen","scrollChatWindow","unseenMessages","filter","m","dateSeen","markMessagesAsRead","chatWindow","openChatWindow","emitMessageSound","emitBrowserNotification","onParticipantClickedFromFriendsList","cancelOptionPrompt","currentActiveOption","isActive","onOptionPromptCanceled","onOptionPromptConfirmed","confirmNewGroup","users","newGroup","groupAdapter","groupCreated","focusOnNewWindow","invokedByUserClick","openedWindow","find","x","emit","collapseWindow","newChatWindow","Window","unshift","focusOnWindow","callback","windowIndex","indexOf","chatWindows","toArray","chatWindowInput","nativeElement","focus","currentDate","Date","audioFile","Audio","src","load","play","notification_1","icon","close","participantIds","w","localStorage","setItem","localStorageKey","JSON","stringify","stringfiedParticipantIds","getItem","participantIds_1","parse","u","getClosestWindow","index","closeWindow","getChatWindowComponentInstance","targetWindow","onWindowMessagesSeen","messagesSeen","onWindowChatClosed","payload","closedWindow","closedViaEscapeKey","log","undefined","beforeParteciantChatClosed","closestWindow","onWindowTabTriggered","triggeringWindow","shiftKeyPressed","currentWindowIndex","windowToFocus","onWindowMessageSent","messageSent","sendMessage","onWindowOptionTriggered","option","triggerOpenChatWindow","user","triggerCloseChatWindow","triggerToggleChatWindowVisibility","onChatWindowClicked","setBeforeParteciantChatClosed","func","HttpClient","Input","Output","ViewChildren","HostListener","Component","selector","template","encapsulation","ViewEncapsulation","None","emojiDictionary","patterns","unicode","EmojifyPipe","transform","pipeEnabled","emoji","pattern","Pipe","LinkfyPipe","replacePatternProtocol","replacePatternWWW","replacePatternMailTo","SanitizePipe","sanitizer","url","bypassSecurityTrustResourceUrl","DomSanitizer","SecurePipe","http","Observable","observer","get","responseType","reader","FileReader","readAsDataURL","onloadend","unsubscribe","GroupMessageDisplayNamePipe","group","userIndex","findIndex","fromId","NgChatOptionsComponent","activeOptionTrackerChange","onOptionClicked","action","NgChatWindowOptionsComponent","buttons","options","button","enableButton","MessageCounter","formatUnreadMessagesTotal","String","unreadMessagesTotal","currentUserId","chatParticipantStatusDescriptor","currentStatus","toLowerCase","NgChatFriendsListComponent","selectedUsersFromFriendsList","searchInput","cleanUpUserSelection","ngOnChanges","changes","currentOptionTriggeredBy_1","item","toUpperCase","includes","isUserSelectedFromFriendsList","unreadMessagesTotalByParticipant","metadata","participantResponse","onChatTitleClicked","onFriendsListCheckboxChange","selectedUser","isChecked","onUserClick","clickedUser","onFriendsListActionCancelClicked","onFriendsListActionConfirmClicked","NgChatWindowComponent","onChatWindowClosed","onMessageSent","onTabTriggered","onOptionTriggered","onLoadHistoryTriggered","fileUploadersInUse","defaultWindowOptions","currentWindow","showOptions","validateContext","displayLabel","isAvatarVisible","getChatWindowAvatar","avatar","getChatWindowAvatarSrc","avatarSrc","isUploadingFile","fileUploadInstanceId","getUniqueFileUploadInstanceId","chatMessages","element","position","scrollHeight","scrollTop","triggerNativeFileUpload","nativeFileInput","click","toggleWindowFocus","unreadMessages","toId","onCloseChatWindow","onChatInputTyped","keyCode","trim","Message","dateSent","preventDefault","shiftKey","clearInUseFileUploader","uploaderInstanceIdIndex","onFileChosen","uploadElementRef","files","fileMessage","ViewChild","NgChatModule","NgModule","imports","CommonModule","FormsModule","HttpClientModule","declarations","exports"],"mappings":"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","sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __createBinding(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (p !== \"default\" && !exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","export enum MessageType\n{\n    Text = 1,\n    File = 2,\n    Image = 3\n}\n","import { Observable } from 'rxjs';\nimport { Message } from \"./message\";\nimport { User } from \"./user\";\nimport { ParticipantResponse } from \"./participant-response\";\nimport { IChatParticipant } from './chat-participant';\n\nexport abstract class ChatAdapter\n{\n    // ### Abstract adapter methods ###\n\n    public abstract listFriends(): Observable<ParticipantResponse[]>;\n    \n    public abstract getMessageHistory(destinataryId: any): Observable<Message[]>;\n\n    public abstract sendMessage(message: Message): void;\n\n    // ### Adapter/Chat income/ingress events ###\n\n    public onFriendsListChanged(participantsResponse: ParticipantResponse[]): void\n    {\n        this.friendsListChangedHandler(participantsResponse);\n    }\n\n    public onMessageReceived(participant: IChatParticipant, message: Message): void\n    {\n        this.messageReceivedHandler(participant, message);\n    }\n    \n    // Event handlers\n    /** @internal */\n    friendsListChangedHandler: (participantsResponse: ParticipantResponse[]) => void  = (participantsResponse: ParticipantResponse[]) => {};\n    /** @internal */\n    messageReceivedHandler: (participant: IChatParticipant, message: Message) => void = (participant: IChatParticipant, message: Message) => {};\n}\n","export enum ChatParticipantStatus\n{\n    Online,\n    Busy,\n    Away,\n    Offline\n}\n","export enum ChatParticipantType\n{\n    User,\n    Group\n}\n","import { MessageType } from './message-type.enum';\n\nexport class Message\n{\n    public type?: MessageType = MessageType.Text;\n    public fromId: any;\n    public toId: any;\n    public message: string;\n    public dateSent?: Date;\n    public dateSeen?: Date;\n}\n","export enum Theme\n{\n    Custom = 'custom-theme',\n    Light = 'light-theme',\n    Dark = 'dark-theme'\n}\n","import { ChatParticipantStatus } from \"./chat-participant-status.enum\";\nimport { IChatParticipant } from \"./chat-participant\";\nimport { ChatParticipantType } from \"./chat-participant-type.enum\";\nimport { WindowOption } from \"./window-option\";\n\nexport class User implements IChatParticipant\n{\n    public readonly participantType: ChatParticipantType = ChatParticipantType.User;\n    public id: any;\n    public displayName: string;\n    public status: ChatParticipantStatus;\n    public avatar: string;\n    public avatarSrc: string;\n    public windowOptions: WindowOption|null;\n}\n","import { User } from \"./user\";\nimport { ParticipantMetadata } from \"./participant-metadata\";\nimport { IChatParticipant } from \"./chat-participant\";\n\nexport class ParticipantResponse\n{\n    public participant: IChatParticipant;\n    public metadata: ParticipantMetadata;\n}\n","export class ParticipantMetadata\n{\n    public totalUnreadMessages: number = 0;\n}\n","import { Message } from \"./message\";\nimport { User } from \"./user\";\nimport { ChatParticipantType } from \"./chat-participant-type.enum\";\nimport { ChatParticipantStatus } from \"./chat-participant-status.enum\";\nimport { Group } from \"./group\";\nimport { IChatParticipant } from \"./chat-participant\";\n\nexport class Window\n{\n    constructor(participant: IChatParticipant, isLoadingHistory: boolean, isCollapsed: boolean)\n    {\n        this.participant = participant;\n        this.messages =  [];\n        this.isLoadingHistory = isLoadingHistory;\n        this.hasFocus = false; // This will be triggered when the 'newMessage' input gets the current focus\n        this.isCollapsed = isCollapsed;\n        this.hasMoreMessages = false;\n        this.historyPage = 0;\n    }\n\n    public participant: IChatParticipant;    \n    public messages: Message[] = [];\n    public newMessage?: string = \"\";\n\n    // UI Behavior properties\n    public isCollapsed?: boolean = false; \n    public isLoadingHistory: boolean = false;\n    public hasFocus: boolean = false;\n    public hasMoreMessages: boolean = true;\n    public historyPage: number = 0;\n}\n","import { Observable } from 'rxjs';\nimport { Message } from \"./message\";\nimport { User } from \"./user\";\nimport { ChatAdapter } from \"./chat-adapter\";\n\n/**\n * @description Chat Adapter decorator class that adds pagination to load the history of messagesr. \n * You will need an existing @see ChatAdapter implementation\n */\nexport abstract class PagedHistoryChatAdapter extends ChatAdapter\n{   \n    abstract getMessageHistoryByPage(destinataryId: any, size: number, page: number) : Observable<Message[]>;\n}\n","export enum ScrollDirection {\n    Top,\n    Bottom\n}","import { Window } from '../core/window';\nimport { IChatParticipant } from '../core/chat-participant';\nimport { WindowButton } from './window-button';\n\nexport class WindowOption\n{\n    public buttons?: Array<WindowButton>;\n    public chattingTo: Window;\n    public windowClass?: string;\n}\n","import { Window } from '../core/window';\nimport { IChatParticipant } from '../core/chat-participant';\n\nexport class WindowButton\n{\n    title: string;\n    showIcon: boolean;\n    icon: string;\n    action?: (chattingTo: Window) => void;\n    enableButton?: (participant: IChatParticipant) => boolean;\n}\n","// Poached from: https://github.com/Steve-Fenton/TypeScriptUtilities\n// @dynamic\nexport class Guid {\n    static newGuid() {\n        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n            var r = Math.random()*16|0, v = c == 'x' ? r : (r&0x3|0x8);\n            return v.toString(16);\n        });\n    }\n}\n","import { Guid } from \"./guid\";\nimport { User } from \"./user\";\nimport { ChatParticipantStatus } from \"./chat-participant-status.enum\";\nimport { IChatParticipant } from \"./chat-participant\";\nimport { ChatParticipantType } from \"./chat-participant-type.enum\";\nimport { WindowOption } from \"./window-option\";\n\nexport class Group implements IChatParticipant\n{\n    constructor(participants: User[])\n    {   \n        this.chattingTo = participants;\n        this.status = ChatParticipantStatus.Online;\n\n        // TODO: Add some customization for this in future releases\n        this.displayName = participants.map((p) => p.displayName).sort((first, second) => second > first ? -1 : 1).join(\", \");\n    }\n\n    public id: string = Guid.newGuid();\n    public chattingTo: User[];\n\n    public readonly participantType: ChatParticipantType = ChatParticipantType.Group;\n\n    public status: ChatParticipantStatus;\n    public avatar: string | null;\n    public avatarSrc: string | null;\n    public displayName: string;\n    public windowOptions: WindowOption|null = null;\n}\n","import { IFileUploadAdapter } from './file-upload-adapter';\nimport { HttpClient, HttpRequest, HttpEventType, HttpResponse, HttpHeaders } from '@angular/common/http';\nimport { Observable, Subject } from 'rxjs';\nimport { User } from './user';\nimport { Message } from './message';\n\nexport class DefaultFileUploadAdapter implements IFileUploadAdapter\n{\n    /**\n     * @summary Basic file upload adapter implementation for HTTP request form file consumption\n     * @param _serverEndpointUrl The API endpoint full qualified address that will receive a form file to process and return the metadata.\n     */\n    constructor(private _serverEndpointUrl: string, private _http: HttpClient) {\n    }\n\n    uploadFile(file: File, participantId: any): Observable<Message> {\n        const formData: FormData = new FormData();\n\n        //formData.append('ng-chat-sender-userid', currentUserId);\n        formData.append('ng-chat-participant-id', participantId);\n        formData.append('file', file, file.name);\n\n        return this._http.post<Message>(this._serverEndpointUrl, formData);\n\n        // TODO: Leaving this if we want to track upload progress in detail in the future. Might need a different Subject generic type wrapper\n        // const fileRequest = new HttpRequest('POST', this._serverEndpointUrl, formData, {\n        //     reportProgress: true\n        // });\n\n        // const uploadProgress = new Subject<number>();\n        // const uploadStatus = uploadProgress.asObservable();\n\n        //const responsePromise = new Subject<Message>();\n\n        // this._http\n        //     .request(fileRequest)\n        //     .subscribe(event => {\n        //         // if (event.type == HttpEventType.UploadProgress)\n        //         // {\n        //         //     const percentDone = Math.round(100 * event.loaded / event.total);\n\n        //         //     uploadProgress.next(percentDone);\n        //         // }\n        //         // else if (event instanceof HttpResponse)\n        //         // {\n                    \n        //         //     uploadProgress.complete();\n        //         // }\n        //     });\n    }\n}\n","import { Component, Input, OnInit, ViewChildren, QueryList, HostListener, Output, EventEmitter, ViewEncapsulation } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\n\nimport { ChatAdapter } from './core/chat-adapter';\nimport { IChatGroupAdapter } from './core/chat-group-adapter';\nimport { User } from \"./core/user\";\nimport { ParticipantResponse } from \"./core/participant-response\";\nimport { Message } from \"./core/message\";\nimport { MessageType } from \"./core/message-type.enum\";\nimport { Window } from \"./core/window\";\nimport { ChatParticipantStatus } from \"./core/chat-participant-status.enum\";\nimport { ScrollDirection } from \"./core/scroll-direction.enum\";\nimport { Localization, StatusDescription } from './core/localization';\nimport { IChatController } from './core/chat-controller';\nimport { PagedHistoryChatAdapter } from './core/paged-history-chat-adapter';\nimport { IFileUploadAdapter } from './core/file-upload-adapter';\nimport { DefaultFileUploadAdapter } from './core/default-file-upload-adapter';\nimport { Theme } from './core/theme.enum';\nimport { IChatOption } from './core/chat-option';\nimport { Group } from \"./core/group\";\nimport { ChatParticipantType } from \"./core/chat-participant-type.enum\";\nimport { IChatParticipant } from \"./core/chat-participant\";\n\nimport { map } from 'rxjs/operators';\nimport { NgChatWindowComponent } from './components/ng-chat-window/ng-chat-window.component';\n\n@Component({\n    selector: 'ng-chat',\n    templateUrl: 'ng-chat.component.html',\n    styleUrls: [\n        'assets/icons.css',\n        'assets/loading-spinner.css',\n        'assets/ng-chat.component.default.css',\n        'assets/themes/ng-chat.theme.default.scss',\n        'assets/themes/ng-chat.theme.dark.scss'\n    ],\n    encapsulation: ViewEncapsulation.None\n})\n\nexport class NgChat implements OnInit, IChatController {\n    constructor(private _httpClient: HttpClient) { }\n\n    // Exposes enums for the ng-template\n    public ChatParticipantType = ChatParticipantType;\n    public ChatParticipantStatus = ChatParticipantStatus;\n    public MessageType = MessageType;\n\n    private _isDisabled: boolean = false;\n\n    get isDisabled(): boolean {\n        return this._isDisabled;\n    }\n      \n    @Input()\n    set isDisabled(value: boolean) {\n        this._isDisabled = value;\n\n        if (value)\n        {\n            // To address issue https://github.com/rpaschoal/ng-chat/issues/120\n            window.clearInterval(this.pollingIntervalWindowInstance)\n        }\n        else\n        {\n            this.activateFriendListFetch();\n        }\n    }\n\n    @Input()\n    public adapter: ChatAdapter;\n\n    @Input()\n    public groupAdapter: IChatGroupAdapter;\n\n    @Input()\n    public userId: any;\n\n    @Input()\n    public isCollapsed: boolean = false;\n\n    @Input()\n    public maximizeWindowOnNewMessage: boolean = true;\n\n    @Input()    \n    public pollFriendsList: boolean = false;\n\n    @Input()\n    public pollingInterval: number = 5000;\n\n    @Input()    \n    public historyEnabled: boolean = true;\n\n    @Input()    \n    public emojisEnabled: boolean = true;\n\n    @Input()    \n    public linkfyEnabled: boolean = true;\n\n    @Input()\n    public audioEnabled: boolean = true;\n\n    @Input()\n    public searchEnabled: boolean = true;\n\n    @Input() // TODO: This might need a better content strategy\n    public audioSource: string = 'https://raw.githubusercontent.com/rpaschoal/ng-chat/master/src/ng-chat/assets/notification.wav';\n\n    @Input()\n    public persistWindowsState: boolean = true;\n\n    @Input()\n    public title: string = \"Friends\";\n\n    @Input()\n    public messagePlaceholder: string = \"Type a message\";\n\n    @Input()\n    public searchPlaceholder: string = \"Search\";\n\n    @Input()\n    public browserNotificationsEnabled: boolean = true;\n\n    @Input() // TODO: This might need a better content strategy\n    public browserNotificationIconSource: string = 'https://raw.githubusercontent.com/rpaschoal/ng-chat/master/src/ng-chat/assets/notification.png';\n\n    @Input()\n    public browserNotificationTitle: string = \"New message from\";\n    \n    @Input()\n    public historyPageSize: number = 10;\n\n    @Input()\n    public localization: Localization;\n\n    @Input()\n    public hideFriendsList: boolean = false;\n\n    @Input()\n    public hideFriendsListOnUnsupportedViewport: boolean = true;\n\n    @Input()\n    public fileUploadUrl: string;\n\n    @Input()\n    public theme: Theme = Theme.Light;\n\n    @Input()\n    public customTheme: string;\n\n    @Input()\n    public messageDatePipeFormat: string = \"short\";\n\n    @Input()\n    public showMessageDate: boolean = true;\n    \n    @Input()\n    public isViewportOnMobileEnabled: boolean = false;\n\n    public beforeParteciantChatClosed: (arg0: IChatParticipant) => boolean;\n     \n    @Output()\n    public onParticipantClicked: EventEmitter<IChatParticipant> = new EventEmitter<IChatParticipant>();\n\n    @Output()\n    public onParticipantChatOpened: EventEmitter<IChatParticipant> = new EventEmitter<IChatParticipant>();\n\n    @Output()\n    public onParticipantChatClosed: EventEmitter<IChatParticipant> = new EventEmitter<IChatParticipant>();\n    \n    @Output()\n    public onMessagesSeen: EventEmitter<Message[]> = new EventEmitter<Message[]>();\n\n    private browserNotificationsBootstrapped: boolean = false;\n\n    public hasPagedHistory: boolean = false;\n\n    // Don't want to add this as a setting to simplify usage. Previous placeholder and title settings available to be used, or use full Localization object.\n    private statusDescription: StatusDescription = {\n        online: 'Online',\n        busy: 'Busy',\n        away: 'Away',\n        offline: 'Offline'\n    };\n\n    private audioFile: HTMLAudioElement;\n\n    public participants: IChatParticipant[];\n\n    public participantsResponse: ParticipantResponse[];\n\n    public participantsInteractedWith: IChatParticipant[] = [];\n\n    public currentActiveOption: IChatOption | null;\n\n    private pollingIntervalWindowInstance: number;\n\n    private get localStorageKey(): string \n    {\n        return `ng-chat-users-${this.userId}`; // Appending the user id so the state is unique per user in a computer.   \n    };\n\n    // Defines the size of each opened window to calculate how many windows can be opened on the viewport at the same time.\n    public windowSizeFactor: number = 320;\n\n    // Total width size of the friends list section\n    public friendsListWidth: number = 262;\n\n    // Available area to render the plugin\n    private viewPortTotalArea: number;\n    \n    // Set to true if there is no space to display at least one chat window and 'hideFriendsListOnUnsupportedViewport' is true\n    public unsupportedViewport: boolean = false;\n\n    // File upload adapter\n    public fileUploadAdapter: IFileUploadAdapter;\n\n    windows: Window[] = [];\n    isBootstrapped: boolean = false;\n\n    @ViewChildren('chatWindow') chatWindows: QueryList<NgChatWindowComponent>;\n\n    ngOnInit() { \n        this.bootstrapChat();\n    }\n\n    @HostListener('window:resize', ['$event'])\n    onResize(event: any){\n       this.viewPortTotalArea = event.target.innerWidth;\n\n       this.NormalizeWindows();\n    }\n\n    // Checks if there are more opened windows than the view port can display\n    private NormalizeWindows(): void\n    {\n        const maxSupportedOpenedWindows = Math.floor((this.viewPortTotalArea - (!this.hideFriendsList ? this.friendsListWidth : 0)) / this.windowSizeFactor);\n        const difference = this.windows.length - maxSupportedOpenedWindows;\n\n        if (difference >= 0)\n        {\n            this.windows.splice(this.windows.length - difference);\n        }\n\n        this.updateWindowsState(this.windows);\n\n        // Viewport should have space for at least one chat window but should show in mobile if option is enabled.\n        this.unsupportedViewport = this.isViewportOnMobileEnabled? false : this.hideFriendsListOnUnsupportedViewport && maxSupportedOpenedWindows < 1;\n    }\n\n    // Initializes the chat plugin and the messaging adapter\n    private bootstrapChat(): void\n    {\n        let initializationException = null;\n\n        if (this.adapter != null && this.userId != null)\n        {\n            try\n            {\n                this.viewPortTotalArea = window.innerWidth;\n\n                this.initializeTheme();\n                this.initializeDefaultText();\n                this.initializeBrowserNotifications();\n\n                // Binding event listeners\n                this.adapter.messageReceivedHandler = (participant, msg) => this.onMessageReceived(participant, msg);\n                this.adapter.friendsListChangedHandler = (participantsResponse) => this.onFriendsListChanged(participantsResponse);\n\n                this.activateFriendListFetch();\n                \n                this.bufferAudioFile();\n\n                this.hasPagedHistory = this.adapter instanceof PagedHistoryChatAdapter;\n                \n                if (this.fileUploadUrl && this.fileUploadUrl !== \"\")\n                {\n                    this.fileUploadAdapter = new DefaultFileUploadAdapter(this.fileUploadUrl, this._httpClient);\n                }\n\n                this.NormalizeWindows();\n\n                this.isBootstrapped = true;\n            }\n            catch(ex)\n            {\n                initializationException = ex;\n            }\n        }\n\n        if (!this.isBootstrapped){\n            console.error(\"ng-chat component couldn't be bootstrapped.\");\n            \n            if (this.userId == null){\n                console.error(\"ng-chat can't be initialized without an user id. Please make sure you've provided an userId as a parameter of the ng-chat component.\");\n            }\n            if (this.adapter == null){\n                console.error(\"ng-chat can't be bootstrapped without a ChatAdapter. Please make sure you've provided a ChatAdapter implementation as a parameter of the ng-chat component.\");\n            }\n            if (initializationException)\n            {\n                console.error(`An exception has occurred while initializing ng-chat. Details: ${initializationException.message}`);\n                console.error(initializationException);\n            }\n        }\n    }\n\n    private activateFriendListFetch(): void {\n        if (this.adapter)\n        {\n            // Loading current users list\n            if (this.pollFriendsList){\n                // Setting a long poll interval to update the friends list\n                this.fetchFriendsList(true);\n                this.pollingIntervalWindowInstance = window.setInterval(() => this.fetchFriendsList(false), this.pollingInterval);\n            }\n            else\n            {\n                // Since polling was disabled, a friends list update mechanism will have to be implemented in the ChatAdapter.\n                this.fetchFriendsList(true);\n            }\n        }\n    }\n\n    // Initializes browser notifications\n    private async initializeBrowserNotifications()\n    {\n        if (this.browserNotificationsEnabled && (\"Notification\" in window))\n        {\n            if (await Notification.requestPermission() === \"granted\")\n            {\n                this.browserNotificationsBootstrapped = true;\n            }\n        }\n    }\n\n    // Initializes default text\n    private initializeDefaultText() : void\n    {\n        if (!this.localization)\n        {\n            this.localization = {\n                messagePlaceholder: this.messagePlaceholder,\n                searchPlaceholder: this.searchPlaceholder, \n                title: this.title,\n                statusDescription: this.statusDescription,\n                browserNotificationTitle: this.browserNotificationTitle,\n                loadMessageHistoryPlaceholder: \"Load older messages\"\n            };\n        }\n    }\n\n    private initializeTheme(): void\n    {\n        if (this.customTheme)\n        {\n            this.theme = Theme.Custom;\n        }\n        else if (this.theme != Theme.Light && this.theme != Theme.Dark)\n        {\n            // TODO: Use es2017 in future with Object.values(Theme).includes(this.theme) to do this check\n            throw new Error(`Invalid theme configuration for ng-chat. \"${this.theme}\" is not a valid theme value.`);\n        }\n    }\n\n    // Sends a request to load the friends list\n    public fetchFriendsList(isBootstrapping: boolean): void\n    {\n        this.adapter.listFriends()\n        .pipe(\n            map((participantsResponse: ParticipantResponse[]) => {\n                this.participantsResponse = participantsResponse;\n\n                this.participants = participantsResponse.map((response: ParticipantResponse) => {\n                    return response.participant;\n                });\n            })\n        ).subscribe(() => {\n            if (isBootstrapping)\n            {\n                this.restoreWindowsState();\n            }\n        });\n    }\n\n    fetchMessageHistory(window: Window) {\n        // Not ideal but will keep this until we decide if we are shipping pagination with the default adapter\n        if (this.adapter instanceof PagedHistoryChatAdapter)\n        {\n            window.isLoadingHistory = true;\n\n            this.adapter.getMessageHistoryByPage(window.participant.id, this.historyPageSize, ++window.historyPage)\n            .pipe(\n                map((result: Message[]) => {\n                    result.forEach((message) => this.assertMessageType(message));\n                    \n                    window.messages = result.concat(window.messages);\n                    window.isLoadingHistory = false;\n    \n                    const direction: ScrollDirection = (window.historyPage == 1) ? ScrollDirection.Bottom : ScrollDirection.Top;\n                    window.hasMoreMessages = result.length == this.historyPageSize;\n                    \n                    setTimeout(() => this.onFetchMessageHistoryLoaded(result, window, direction, true));\n                })\n            ).subscribe();\n        }\n        else\n        {\n            this.adapter.getMessageHistory(window.participant.id)\n            .pipe(\n                map((result: Message[]) => {\n                    result.forEach((message) => this.assertMessageType(message));\n    \n                    window.messages = result.concat(window.messages);\n                    window.isLoadingHistory = false;\n    \n                    setTimeout(() => this.onFetchMessageHistoryLoaded(result, window, ScrollDirection.Bottom));\n                })\n            ).subscribe();\n        }\n    }\n\n    private onFetchMessageHistoryLoaded(messages: Message[], window: Window, direction: ScrollDirection, forceMarkMessagesAsSeen: boolean = false): void \n    {\n        this.scrollChatWindow(window, direction)\n\n        if (window.hasFocus || forceMarkMessagesAsSeen)\n        {\n            const unseenMessages = messages.filter(m => !m.dateSeen);\n\n            this.markMessagesAsRead(unseenMessages);\n        }\n    }\n\n    // Updates the friends list via the event handler\n    private onFriendsListChanged(participantsResponse: ParticipantResponse[]): void\n    {\n        if (participantsResponse) \n        {\n            this.participantsResponse = participantsResponse;\n\n            this.participants = participantsResponse.map((response: ParticipantResponse) => {\n                return response.participant;\n            });\n\n            this.participantsInteractedWith = [];\n        }\n    }\n\n    // Handles received messages by the adapter\n    private onMessageReceived(participant: IChatParticipant, message: Message)\n    {\n        if (participant && message)\n        {\n            const chatWindow = this.openChatWindow(participant);\n\n            this.assertMessageType(message);\n\n            if (!chatWindow[1] || !this.historyEnabled){\n                chatWindow[0].messages.push(message);\n\n                this.scrollChatWindow(chatWindow[0], ScrollDirection.Bottom);\n\n                if (chatWindow[0].hasFocus)\n                {\n                    this.markMessagesAsRead([message]);\n                }\n            }\n\n            this.emitMessageSound(chatWindow[0]);\n            \n            // Github issue #58 \n            // Do not push browser notifications with message content for privacy purposes if the 'maximizeWindowOnNewMessage' setting is off and this is a new chat window.\n            if (this.maximizeWindowOnNewMessage || (!chatWindow[1] && !chatWindow[0].isCollapsed))\n            { \n                // Some messages are not pushed because they are loaded by fetching the history hence why we supply the message here\n                this.emitBrowserNotification(chatWindow[0], message);\n            }\n        }\n    }\n\n    onParticipantClickedFromFriendsList(participant: IChatParticipant): void {\n        this.openChatWindow(participant, true, true);\n    }\n\n    private cancelOptionPrompt(): void {\n        if (this.currentActiveOption)\n        {\n            this.currentActiveOption.isActive = false;\n            this.currentActiveOption = null;\n        }\n    }\n\n    onOptionPromptCanceled(): void {\n        this.cancelOptionPrompt();\n    }\n\n    onOptionPromptConfirmed(event: any): void {\n        // For now this is fine as there is only one option available. Introduce option types and type checking if a new option is added.\n        this.confirmNewGroup(event);\n\n        // Canceling current state\n        this.cancelOptionPrompt();\n    }\n\n    private confirmNewGroup(users: User[]): void {\n        const newGroup = new Group(users);\n\n        this.openChatWindow(newGroup);\n\n        if (this.groupAdapter)\n        {\n            this.groupAdapter.groupCreated(newGroup);\n        }\n    }\n\n    // Opens a new chat whindow. Takes care of available viewport\n    // Works for opening a chat window for an user or for a group\n    // Returns => [Window: Window object reference, boolean: Indicates if this window is a new chat window]\n    private openChatWindow(participant: IChatParticipant, focusOnNewWindow: boolean = false, invokedByUserClick: boolean = false): [Window, boolean]\n    {\n        // Is this window opened?\n        const openedWindow = this.windows.find(x => x.participant.id == participant.id);\n\n        if (!openedWindow)\n        {\n            if (invokedByUserClick) \n            {\n                this.onParticipantClicked.emit(participant);\n            }\n\n            // Refer to issue #58 on Github \n            const collapseWindow = invokedByUserClick ? false : !this.maximizeWindowOnNewMessage;\n\n            const newChatWindow: Window = new Window(participant, this.historyEnabled, collapseWindow);\n\n            // Loads the chat history via an RxJs Observable\n            if (this.historyEnabled)\n            {\n                this.fetchMessageHistory(newChatWindow);\n            }\n\n            this.windows.unshift(newChatWindow);\n\n            // Is there enough space left in the view port ? but should be displayed in mobile if option is enabled\n            if (!this.isViewportOnMobileEnabled) {\n                if (this.windows.length * this.windowSizeFactor >= this.viewPortTotalArea - (!this.hideFriendsList ? this.friendsListWidth : 0)) {\n                    this.windows.pop();\n                }\n            }\n\n            this.updateWindowsState(this.windows);\n            \n            if (focusOnNewWindow && !collapseWindow) \n            {\n                this.focusOnWindow(newChatWindow);\n            }\n\n            this.participantsInteractedWith.push(participant);\n            this.onParticipantChatOpened.emit(participant);\n\n            return [newChatWindow, true];\n        }\n        else\n        {\n            // Returns the existing chat window     \n            return [openedWindow, false];       \n        }\n    }\n\n    // Focus on the input element of the supplied window\n    private focusOnWindow(window: Window, callback: Function = () => {}) : void\n    {\n        const windowIndex = this.windows.indexOf(window);\n        if (windowIndex >= 0)\n        {\n            setTimeout(() => {\n                if (this.chatWindows)\n                {\n                    const chatWindowToFocus = this.chatWindows.toArray()[windowIndex];\n\n                    chatWindowToFocus.chatWindowInput.nativeElement.focus();\n                }\n\n                callback(); \n            });\n        } \n    }\n\n    private assertMessageType(message: Message): void {\n        // Always fallback to \"Text\" messages to avoid rendenring issues\n        if (!message.type)\n        {\n            message.type = MessageType.Text;\n        }\n    }\n\n    // Marks all messages provided as read with the current time.\n    markMessagesAsRead(messages: Message[]): void\n    {\n        const currentDate = new Date();\n\n        messages.forEach((msg)=>{\n            msg.dateSeen = currentDate;\n        });\n\n        this.onMessagesSeen.emit(messages);\n    }\n\n    // Buffers audio file (For component's bootstrapping)\n    private bufferAudioFile(): void {\n        if (this.audioSource && this.audioSource.length > 0)\n        {\n            this.audioFile = new Audio();\n            this.audioFile.src = this.audioSource;\n            this.audioFile.load();\n        }\n    }\n\n    // Emits a message notification audio if enabled after every message received\n    private emitMessageSound(window: Window): void\n    {\n        if (this.audioEnabled && !window.hasFocus && this.audioFile) {\n            this.audioFile.play();\n        }\n    }\n\n    // Emits a browser notification\n    private emitBrowserNotification(window: Window, message: Message): void\n    {       \n        if (this.browserNotificationsBootstrapped && !window.hasFocus && message) {\n            const notification = new Notification(`${this.localization.browserNotificationTitle} ${window.participant.displayName}`, {\n                'body': message.message,\n                'icon': this.browserNotificationIconSource\n            });\n\n            setTimeout(() => {\n                notification.close();\n            }, message.message.length <= 50 ? 5000 : 7000); // More time to read longer messages\n        }\n    }\n\n    // Saves current windows state into local storage if persistence is enabled\n    private updateWindowsState(windows: Window[]): void\n    {\n        if (this.persistWindowsState)\n        {\n            const participantIds = windows.map((w) => {\n                return w.participant.id;\n            });\n\n            localStorage.setItem(this.localStorageKey, JSON.stringify(participantIds));\n        }\n    }\n\n    private restoreWindowsState(): void\n    {\n        try\n        {\n            if (this.persistWindowsState)\n            {\n                const stringfiedParticipantIds = localStorage.getItem(this.localStorageKey);\n\n                if (stringfiedParticipantIds && stringfiedParticipantIds.length > 0)\n                {\n                    const participantIds = <number[]>JSON.parse(stringfiedParticipantIds);\n\n                    const participantsToRestore = this.participants.filter(u => participantIds.indexOf(u.id) >= 0);\n\n                    participantsToRestore.forEach((participant) => {\n                        this.openChatWindow(participant);\n                    });\n                }\n            }\n        }\n        catch (ex)\n        {\n            console.error(`An error occurred while restoring ng-chat windows state. Details: ${ex}`);\n        }\n    }\n\n    // Gets closest open window if any. Most recent opened has priority (Right)\n    private getClosestWindow(window: Window): Window | undefined\n    {   \n        const index = this.windows.indexOf(window);\n\n        if (index > 0)\n        {\n            return this.windows[index - 1];\n        }\n        else if (index == 0 && this.windows.length > 1)\n        {   \n            return this.windows[index + 1];\n        }\n    }\n\n    private closeWindow(window: Window): void \n    {\n        const index = this.windows.indexOf(window);\n\n        this.windows.splice(index, 1);\n\n        this.updateWindowsState(this.windows);\n\n        this.onParticipantChatClosed.emit(window.participant);\n    }\n\n    private getChatWindowComponentInstance(targetWindow: Window): NgChatWindowComponent | null {\n        const windowIndex = this.windows.indexOf(targetWindow);\n\n        if (this.chatWindows){\n            let targetWindow = this.chatWindows.toArray()[windowIndex];\n\n            return targetWindow;\n        }\n\n        return null;\n    }\n\n    // Scrolls a chat window message flow to the bottom\n    private scrollChatWindow(window: Window, direction: ScrollDirection): void\n    {\n        const chatWindow = this.getChatWindowComponentInstance(window);\n\n        if (chatWindow){\n            chatWindow.scrollChatWindow(window, direction);\n        }\n    }\n\n    onWindowMessagesSeen(messagesSeen: Message[]): void {\n        this.markMessagesAsRead(messagesSeen);\n    }\n\n    async onWindowChatClosed(payload: { closedWindow: Window, closedViaEscapeKey: boolean }) {\n        const { closedWindow, closedViaEscapeKey } = payload;\n        console.log('onWindowChatClosed');\n        if(this.beforeParteciantChatClosed != undefined && this.beforeParteciantChatClosed) {\n            const l = await this.beforeParteciantChatClosed(closedWindow.participant);\n            if(l == false)\n                return;\n        }\n        if (closedViaEscapeKey) {\n            let closestWindow = this.getClosestWindow(closedWindow);\n\n            if (closestWindow)\n            {\n                this.focusOnWindow(closestWindow, () => { this.closeWindow(closedWindow); });\n            }\n            else\n            {\n                this.closeWindow(closedWindow);\n            }\n        }\n        else { \n            this.closeWindow(closedWindow);\n        }\n    }\n\n    onWindowTabTriggered(payload: { triggeringWindow: Window, shiftKeyPressed: boolean }): void {\n        const { triggeringWindow, shiftKeyPressed } = payload;\n\n        const currentWindowIndex = this.windows.indexOf(triggeringWindow);\n        let windowToFocus = this.windows[currentWindowIndex + (shiftKeyPressed ? 1 : -1)]; // Goes back on shift + tab\n\n        if (!windowToFocus)\n        {\n            // Edge windows, go to start or end\n            windowToFocus = this.windows[currentWindowIndex > 0 ? 0 : this.chatWindows.length - 1]; \n        }\n\n        this.focusOnWindow(windowToFocus);\n    }\n\n    onWindowMessageSent(messageSent: Message): void {\n        this.adapter.sendMessage(messageSent);\n    }\n    \n    onWindowOptionTriggered(option: IChatOption): void {\n        this.currentActiveOption = option;\n    }\n\n    triggerOpenChatWindow(user: User): void {\n        if (user)\n        {\n            this.openChatWindow(user);\n        }\n    }\n\n    triggerCloseChatWindow(userId: any): void {\n        const openedWindow = this.windows.find(x => x.participant.id == userId);\n\n        if (openedWindow) \n        {\n            this.closeWindow(openedWindow);\n        }\n    }\n\n    triggerToggleChatWindowVisibility(userId: any): void {\n        const openedWindow = this.windows.find(x => x.participant.id == userId);\n\n        if (openedWindow) \n        {\n            const chatWindow = this.getChatWindowComponentInstance(openedWindow);\n\n            if (chatWindow){\n                chatWindow.onChatWindowClicked(openedWindow);\n            }\n        }\n    }\n\n    setBeforeParteciantChatClosed(func: any) {\n        this.beforeParteciantChatClosed = func;\n    }\n}","import { Pipe, PipeTransform } from '@angular/core';\n\nlet emojiDictionary = [\n    { patterns: [':)', ':-)', '=)'], unicode: '😃' },\n    { patterns: [':D', ':-D', '=D'], unicode: '😀' },\n    { patterns: [':(', ':-(', '=('], unicode: '🙁' },\n    { patterns: [':|', ':-|', '=|'], unicode: '😐' },\n    { patterns: [':*', ':-*', '=*'], unicode: '😙' },\n    { patterns: ['T_T', 'T.T'], unicode: '😭' },\n    { patterns: [':O', ':-O', '=O', ':o', ':-o', '=o'], unicode: '😮' },\n    { patterns: [':P', ':-P', '=P', ':p', ':-p', '=p'], unicode: '😋' },\n    { patterns: ['>.<'], unicode: '😣' },\n    { patterns: ['@.@'], unicode: '😵' },\n    { patterns: ['*.*'], unicode: '😍' },\n    { patterns: ['<3'], unicode: '❤️' },\n    { patterns: ['^.^'], unicode: '😊' },\n    { patterns: [':+1'], unicode: '👍' },\n    { patterns: [':-1'], unicode: '👎' }\n];\n\n/*\n * Transforms common emoji text to UTF encoded emojis\n*/\n@Pipe({name: 'emojify'})\nexport class EmojifyPipe implements PipeTransform {\n    transform(message: string, pipeEnabled: boolean): string {\n        if (pipeEnabled && message && message.length > 1) {  \n            emojiDictionary.forEach(emoji => {\n                emoji.patterns.forEach(pattern => {\n                    message = message.replace(pattern, emoji.unicode);\n                })\n            });\n        }\n\n    return message;\n  }\n}\n","import { Pipe, PipeTransform } from '@angular/core';\n\n/*\n * Transforms text containing URLs or E-mails to valid links/mailtos\n*/\n@Pipe({name: 'linkfy'})\nexport class LinkfyPipe implements PipeTransform {\n    transform(message: string, pipeEnabled: boolean): string {\n        if (pipeEnabled && message && message.length > 1)\n        {\n            let replacedText;\n            let replacePatternProtocol;\n            let replacePatternWWW;\n            let replacePatternMailTo;\n\n            // URLs starting with http://, https://, or ftp://\n            replacePatternProtocol = /(\\b(https?|ftp):\\/\\/[-A-Z0-9+&@#\\/%?=~_|!:,.;]*[-A-Z0-9+&@#\\/%=~_|])/gim;\n            replacedText = message.replace(replacePatternProtocol, '<a href=\"$1\" target=\"_blank\">$1</a>');\n\n            // URLs starting with \"www.\" (ignoring // before it).\n            replacePatternWWW = /(^|[^\\/])(www\\.[\\S]+(\\b|$))/gim;\n            replacedText = replacedText.replace(replacePatternWWW, '$1<a href=\"http://$2\" target=\"_blank\">$2</a>');\n\n            // Change email addresses to mailto:: links.\n            replacePatternMailTo = /(([a-zA-Z0-9\\-\\_\\.])+@[a-zA-Z\\_]+?(\\.[a-zA-Z]{2,6})+)/gim;\n            replacedText = replacedText.replace(replacePatternMailTo, '<a href=\"mailto:$1\">$1</a>');\n\n            return replacedText;\n        }\n        else\n            return message;\n    } \n}\n","import { Pipe, PipeTransform } from '@angular/core';\nimport { DomSanitizer, SafeResourceUrl  } from '@angular/platform-browser';\n\n/*\n * Sanitizes an URL resource\n*/\n@Pipe({name: 'sanitize'})\nexport class SanitizePipe implements PipeTransform {\n    constructor(protected sanitizer: DomSanitizer) {}\n\n    transform(url: string): SafeResourceUrl {\n        return this.sanitizer.bypassSecurityTrustResourceUrl(url);\n    }\n}\n","import { Pipe, PipeTransform } from '@angular/core';\nimport { DomSanitizer, SafeResourceUrl  } from '@angular/platform-browser';\nimport { HttpClient } from '@angular/common/http';\nimport { Observable } from 'rxjs';\n\n/*\n * Sanitizes an URL resource\n*/\n@Pipe({name: 'secure'})\nexport class SecurePipe implements PipeTransform {\n\n    constructor(private http: HttpClient) { }\n  \n    transform(url: string) {\n  \n      return new Observable<string|ArrayBuffer>((observer) => {\n        // This is a tiny blank image\n        observer.next('data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==');\n  \n        // The next and error callbacks from the observer\n        const {next, error} = observer;\n        console.log('secure pipe');\n        this.http.get(url, {responseType: 'blob'}).subscribe(response => {\n          const reader = new FileReader();\n          reader.readAsDataURL(response);\n          reader.onloadend = function() {\n              if(reader.result != null)\n                observer.next(reader.result);\n          };\n        });\n  \n        return {unsubscribe() {  }};\n      });\n    }\n  }\n","import { Pipe, PipeTransform } from '@angular/core';\nimport { Group } from \"../core/group\";\nimport { ChatParticipantType } from \"../core/chat-participant-type.enum\";\nimport { IChatParticipant } from \"../core/chat-participant\";\nimport { Message } from \"../core/message\";\n\n/*\n * Renders the display name of a participant in a group based on who's sent the message\n*/\n@Pipe({name: 'groupMessageDisplayName'})\nexport class GroupMessageDisplayNamePipe implements PipeTransform {\n    transform(participant: IChatParticipant, message: Message): string {\n        if (participant && participant.participantType == ChatParticipantType.Group)\n        {\n            let group = participant as Group;\n            let userIndex = group.chattingTo.findIndex(x => x.id == message.fromId);\n\n            return group.chattingTo[userIndex >= 0 ? userIndex : 0].displayName;\n        }\n        else\n            return \"\";\n    } \n}\n","import { Component, Input, Output, EventEmitter } from '@angular/core';\nimport { IChatOption } from '../../core/chat-option';\n\n@Component({\n    selector: 'ng-chat-options',\n    templateUrl: './ng-chat-options.component.html',\n    styleUrls: ['./ng-chat-options.component.css']\n})\nexport class NgChatOptionsComponent {\n\n\tconstructor() { }\n\n\t@Input()\n\tpublic options: IChatOption[];\n\n\t@Input()\n\tpublic activeOptionTracker: IChatOption;\n\n\t@Output()\n\tpublic activeOptionTrackerChange: EventEmitter<IChatOption> = new EventEmitter<IChatOption>();\n\n\tonOptionClicked(option: IChatOption): void\n\t{\n\t\toption.isActive = true;\n\n\t\tif (option.action) {    \n\t\t\toption.action(option.chattingTo);   \n\t\t}\n\n\t\tthis.activeOptionTrackerChange.emit(option);\n\t}\n}\n","import { Component, Input, Output, EventEmitter } from '@angular/core';\nimport { IChatOption } from '../../core/chat-option';\nimport { WindowOption } from '../../core/window-option';\nimport { WindowButton } from '../../core/window-button';\n\n@Component({\n    selector: 'ng-chat-window-options',\n    templateUrl: './ng-chat-window-options.component.html',\n    styleUrls: ['./ng-chat-window-options.component.css']\n})\nexport class NgChatWindowOptionsComponent {\n\tbuttons: WindowButton[] | undefined;\n\n\tconstructor() { \n\t\tthis.buttons = this.options.buttons;\n\t}\n\n\t// {\n\t// \ttitle: string;\n\t// \tshowIcon: boolean;\n\t// \ticon: string;\n\t// \taction?: (chattingTo: Window) => void;\n\t// \tenableButton?: (participant: IChatParticipant) => boolean;\n\t// }\n\n\t@Input()\n\tpublic options: WindowOption;\n\n\t@Input()\n\tpublic activeOptionTracker: WindowOption;\n\n\t@Output()\n\tpublic activeOptionTrackerChange: EventEmitter<WindowOption> = new EventEmitter<WindowOption>();\n\n\tonOptionClicked(option: WindowOption, button: WindowButton): void\n\t{\n\t\tif (button.action) {    \n\t\t\tif(button.enableButton) {\n\t\t\t\tif(!button.enableButton(option.chattingTo.participant))\n\t\t\t\t\treturn;\n\t\t\t}\n\t\t\tbutton.action(option.chattingTo);   \n\t\t}\n\t\tif(this.activeOptionTrackerChange)\n\t\t\tthis.activeOptionTrackerChange.emit(option);\n\t}\n}\n","import { Window } from './window';\n\nexport class MessageCounter\n{\n    public static formatUnreadMessagesTotal(totalUnreadMessages: number): string\n    {\n        if (totalUnreadMessages > 0){\n\n            if (totalUnreadMessages > 99) \n                return  \"99+\";\n            else\n                return String(totalUnreadMessages); \n        }\n\n        // Empty fallback.\n        return \"\";\n    }\n\n    /**\n     * Returns a formatted string containing the total unread messages of a chat window.\n     * @param window The window instance to count the unread total messages.\n     * @param currentUserId The current chat instance user id. In this context it would be the sender.\n     */\n    public static unreadMessagesTotal(window: Window, currentUserId: any): string\n    {\n        let totalUnreadMessages = 0;\n\n        if (window){\n            totalUnreadMessages = window.messages.filter(x => x.fromId != currentUserId && !x.dateSeen).length;\n        }\n            \n        return MessageCounter.formatUnreadMessagesTotal(totalUnreadMessages);\n    }\n}\n","import { ChatParticipantStatus } from './chat-participant-status.enum';\nimport { Localization } from './localization'\n \nexport function chatParticipantStatusDescriptor(status: ChatParticipantStatus, localization: Localization) {\n    const currentStatus = ChatParticipantStatus[status].toString().toLowerCase();\n    \n    return localization.statusDescription[currentStatus];\n}","import { Component, Input, Output, EventEmitter, ViewEncapsulation, OnChanges, SimpleChanges } from '@angular/core';\n\nimport { Localization } from '../../core/localization';\nimport { IChatOption } from '../../core/chat-option';\nimport { ChatParticipantStatus } from \"../../core/chat-participant-status.enum\";\nimport { IChatParticipant } from \"../../core/chat-participant\";\nimport { User } from \"../../core/user\";\nimport { Window } from \"../../core/window\";\nimport { ParticipantResponse } from \"../../core/participant-response\";\nimport { MessageCounter } from \"../../core/message-counter\";\nimport { chatParticipantStatusDescriptor } from '../../core/chat-participant-status-descriptor';\n\n@Component({\n    selector: 'ng-chat-friends-list',\n    templateUrl: './ng-chat-friends-list.component.html',\n    styleUrls: ['./ng-chat-friends-list.component.css'],\n    encapsulation: ViewEncapsulation.None\n})\nexport class NgChatFriendsListComponent implements OnChanges {\n    constructor() { }\n\n    @Input()\n    public participants: IChatParticipant[];\n\n    @Input()\n    public participantsResponse: ParticipantResponse[];\n\n    @Input()\n    public participantsInteractedWith: IChatParticipant[] = [];\n\n    @Input()\n    public windows: Window[];\n\n    @Input()\n    public userId: any;\n\n    @Input()\n    public localization: Localization;\n\n    @Input()\n    public shouldDisplay: boolean;\n\n    @Input()\n    public isCollapsed: boolean;\n\n    @Input()\n    public searchEnabled: boolean;\n\n    @Input()\n    public currentActiveOption: IChatOption | null;\n\n    @Output()\n    public onParticipantClicked: EventEmitter<IChatParticipant> = new EventEmitter();\n\n    @Output()\n    public onOptionPromptCanceled: EventEmitter<any> = new EventEmitter();\n\n    @Output()\n    public onOptionPromptConfirmed: EventEmitter<any> = new EventEmitter();\n\n    public selectedUsersFromFriendsList: User[] = [];\n\n    public searchInput: string = '';\n\n    // Exposes enums and functions for the ng-template\n    public ChatParticipantStatus = ChatParticipantStatus;\n    public chatParticipantStatusDescriptor = chatParticipantStatusDescriptor;\n\n    ngOnChanges(changes: SimpleChanges) {\n        if (this.currentActiveOption) {\n            const currentOptionTriggeredBy = this.currentActiveOption && this.currentActiveOption.chattingTo.participant.id;\n            const isActivatedUserInSelectedList = (this.selectedUsersFromFriendsList.filter(item => item.id == currentOptionTriggeredBy)).length > 0;\n\n            if (!isActivatedUserInSelectedList) {\n                this.selectedUsersFromFriendsList = this.selectedUsersFromFriendsList.concat(this.currentActiveOption.chattingTo.participant as User);\n            }\n        }\n    }\n\n    get filteredParticipants(): IChatParticipant[]\n    {\n        if (this.searchInput.length > 0){\n            // Searches in the friend list by the inputted search string\n            return this.participants.filter(x => x.displayName.toUpperCase().includes(this.searchInput.toUpperCase()));\n        }\n\n        return this.participants;\n    }\n\n    isUserSelectedFromFriendsList(user: User) : boolean\n    {\n        return (this.selectedUsersFromFriendsList.filter(item => item.id == user.id)).length > 0\n    }\n\n    unreadMessagesTotalByParticipant(participant: IChatParticipant): string\n    {\n        let openedWindow = this.windows.find(x => x.participant.id == participant.id);\n\n        if (openedWindow){\n            return MessageCounter.unreadMessagesTotal(openedWindow, this.userId);\n        }\n        else\n        {\n            let totalUnreadMessages = this.participantsResponse\n                .filter(x => x.participant.id == participant.id && !this.participantsInteractedWith.find(u => u.id == participant.id) && x.metadata && x.metadata.totalUnreadMessages > 0)\n                .map((participantResponse) => {\n                    return participantResponse.metadata.totalUnreadMessages\n                })[0];\n\n            return MessageCounter.formatUnreadMessagesTotal(totalUnreadMessages);\n        }\n    }\n\n    cleanUpUserSelection = () => this.selectedUsersFromFriendsList = [];\n\n    // Toggle friends list visibility\n    onChatTitleClicked(): void\n    {\n        this.isCollapsed = !this.isCollapsed;\n    }\n\n    onFriendsListCheckboxChange(selectedUser: User, isChecked: boolean): void\n    {\n        if(isChecked) {\n            this.selectedUsersFromFriendsList.push(selectedUser);\n        } \n        else \n        {\n            this.selectedUsersFromFriendsList.splice(this.selectedUsersFromFriendsList.indexOf(selectedUser), 1);\n        }\n    }\n\n    onUserClick(clickedUser: User): void\n    {\n        this.onParticipantClicked.emit(clickedUser);\n    }\n\n    onFriendsListActionCancelClicked(): void\n    {\n        this.onOptionPromptCanceled.emit();\n        this.cleanUpUserSelection();\n    }\n\n    onFriendsListActionConfirmClicked() : void\n    {\n        this.onOptionPromptConfirmed.emit(this.selectedUsersFromFriendsList);\n        this.cleanUpUserSelection();\n    }\n}\n","import { Component, Input, Output, EventEmitter, ViewEncapsulation, ViewChild, ElementRef } from '@angular/core';\n\nimport { Message } from \"../../core/message\";\nimport { MessageType } from \"../../core/message-type.enum\";\nimport { Window } from \"../../core/window\";\nimport { ChatParticipantStatus } from \"../../core/chat-participant-status.enum\";\nimport { ScrollDirection } from \"../../core/scroll-direction.enum\";\nimport { Localization } from '../../core/localization';\nimport { IFileUploadAdapter } from '../../core/file-upload-adapter';\nimport { IChatOption } from '../../core/chat-option';\nimport { WindowOption } from '../../core/window-option';\nimport { Group } from \"../../core/group\";\nimport { ChatParticipantType } from \"../../core/chat-participant-type.enum\";\nimport { IChatParticipant } from \"../../core/chat-participant\";\nimport { MessageCounter } from \"../../core/message-counter\";\nimport { chatParticipantStatusDescriptor } from '../../core/chat-participant-status-descriptor';\n\n@Component({\n    selector: 'ng-chat-window',\n    templateUrl: './ng-chat-window.component.html',\n    styleUrls: ['./ng-chat-window.component.css'],\n    encapsulation: ViewEncapsulation.None\n})\nexport class NgChatWindowComponent {\n    constructor() {\n        this.windowOptions = this.window.participant.windowOptions;\n     }\n\n     windowOptions: WindowOption | null;\n\n\n    @Input()\n    public fileUploadAdapter: IFileUploadAdapter;\n\n    @Input()\n    public window: Window;\n\n    @Input()\n    public userId: any;\n\n    @Input()\n    public localization: Localization;\n\n    @Input()\n    public showOptions: boolean;\n\n    @Input()    \n    public emojisEnabled: boolean = true;\n\n    @Input()    \n    public linkfyEnabled: boolean = true;\n\n    @Input()\n    public showMessageDate: boolean = true;\n\n    @Input()\n    public messageDatePipeFormat: string = \"short\";\n\n    @Input()\n    public hasPagedHistory: boolean = true;\n\n    @Output()\n    public onChatWindowClosed: EventEmitter<{ closedWindow: Window, closedViaEscapeKey: boolean}> = new EventEmitter();\n\n    @Output()\n    public onMessagesSeen: EventEmitter<Message[]> = new EventEmitter();\n\n    @Output()\n    public onMessageSent: EventEmitter<Message> = new EventEmitter();\n\n    @Output()\n    public onTabTriggered: EventEmitter<{ triggeringWindow: Window, shiftKeyPressed: boolean }> = new EventEmitter();\n\n    @Output()\n    public onOptionTriggered: EventEmitter<IChatOption> = new EventEmitter();\n\n    @Output()\n    public onLoadHistoryTriggered: EventEmitter<Window> = new EventEmitter();\n\n    @ViewChild('chatMessages') chatMessages: any;\n    @ViewChild('nativeFileInput') nativeFileInput: ElementRef;\n    @ViewChild('chatWindowInput') chatWindowInput: any;\n\n    // File upload state\n    public fileUploadersInUse: string[] = []; // Id bucket of uploaders in use\n\n    // Exposes enums and functions for the ng-template\n    public ChatParticipantType = ChatParticipantType;\n    public ChatParticipantStatus = ChatParticipantStatus;\n    public MessageType = MessageType;\n    public chatParticipantStatusDescriptor = chatParticipantStatusDescriptor;\n\n    defaultWindowOptions(currentWindow: Window): IChatOption[]\n    {\n        if (this.showOptions && currentWindow.participant.participantType == ChatParticipantType.User)\n        {\n            return [{\n                isActive: false,\n                chattingTo: currentWindow,\n                validateContext: (participant: IChatParticipant) => {\n                    return participant.participantType == ChatParticipantType.User;\n                },\n                displayLabel: 'Add People' // TODO: Localize this\n            }];\n        }\n\n        return [];\n    }\n\n    // Asserts if a user avatar is visible in a chat cluster\n    isAvatarVisible(window: Window, message: Message, index: number): boolean\n    {\n        if (message.fromId != this.userId){\n            if (index == 0){\n                return true; // First message, good to show the thumbnail\n            }\n            else{\n                // Check if the previous message belongs to the same user, if it belongs there is no need to show the avatar again to form the message cluster\n                if (window.messages[index - 1].fromId != message.fromId){\n                    return true;\n                }\n            }\n        }\n\n        return false;\n    }\n\n    getChatWindowAvatar(participant: IChatParticipant, message: Message): string | null\n    {\n        if (participant.participantType == ChatParticipantType.User)\n        {\n            return participant.avatar;\n        }\n        else if (participant.participantType == ChatParticipantType.Group)\n        {\n            let group = participant as Group;\n            let userIndex = group.chattingTo.findIndex(x => x.id == message.fromId);\n\n            return group.chattingTo[userIndex >= 0 ? userIndex : 0].avatar;\n        }\n\n        return null;\n    }\n\n    getChatWindowAvatarSrc(participant: IChatParticipant, message: Message): string | null\n    {\n        if (participant.participantType == ChatParticipantType.User)\n        {\n            return participant.avatarSrc;\n        }\n        // else if (participant.participantType == ChatParticipantType.Group)\n        // {\n        //     let group = participant as Group;\n        //     let userIndex = group.chattingTo.findIndex(x => x.id == message.fromId);\n\n        //     return group.chattingTo[userIndex >= 0 ? userIndex : 0].avatar;\n        // }\n\n        return null;\n    }\n\n    isUploadingFile(window: Window): boolean\n    {\n        const fileUploadInstanceId = this.getUniqueFileUploadInstanceId(window);\n\n        return this.fileUploadersInUse.indexOf(fileUploadInstanceId) > -1;\n    }\n\n    // Generates a unique file uploader id for each participant\n    getUniqueFileUploadInstanceId(window: Window): string\n    {\n        if (window && window.participant)\n        {\n            return `ng-chat-file-upload-${window.participant.id}`;\n        }\n        \n        return 'ng-chat-file-upload';\n    }\n\n    unreadMessagesTotal(window: Window): string\n    {           \n        return MessageCounter.unreadMessagesTotal(window, this.userId);\n    }\n\n    // Scrolls a chat window message flow to the bottom\n    scrollChatWindow(window: Window, direction: ScrollDirection): void\n    {\n        if (!window.isCollapsed){\n            setTimeout(() => {\n                if (this.chatMessages){\n                    let element = this.chatMessages.nativeElement;\n                    let position = ( direction === ScrollDirection.Top ) ? 0 : element.scrollHeight;\n                    element.scrollTop = position;\n                }\n            }); \n        }\n    }\n\n    activeOptionTrackerChange(option: IChatOption): void {\n        this.onOptionTriggered.emit(option);\n    }\n\n    // Triggers native file upload for file selection from the user\n    triggerNativeFileUpload(window: Window): void\n    {\n        if (window)\n        {\n            if (this.nativeFileInput) this.nativeFileInput.nativeElement.click();\n        }\n    }\n\n    // Toggles a window focus on the focus/blur of a 'newMessage' input\n    toggleWindowFocus(window: Window): void\n    {\n        window.hasFocus = !window.hasFocus;\n        if(window.hasFocus) {\n            const unreadMessages = window.messages\n                .filter(message => message.dateSeen == null \n                    && (message.toId == this.userId || window.participant.participantType === ChatParticipantType.Group));\n            \n            if (unreadMessages && unreadMessages.length > 0)\n            {\n                this.onMessagesSeen.emit(unreadMessages);\n            }\n        }\n    }\n\n    markMessagesAsRead(messages: Message[]): void \n    {\n        this.onMessagesSeen.emit(messages);\n    }\n\n    fetchMessageHistory(window: Window): void {\n        this.onLoadHistoryTriggered.emit(window);\n    }\n\n    // Closes a chat window via the close 'X' button\n    onCloseChatWindow(): void \n    {\n        this.onChatWindowClosed.emit({ closedWindow: this.window, closedViaEscapeKey: false });\n    }\n\n    /*  Monitors pressed keys on a chat window\n        - Dispatches a message when the ENTER key is pressed\n        - Tabs between windows on TAB or SHIFT + TAB\n        - Closes the current focused window on ESC\n    */\n   onChatInputTyped(event: any, window: Window): void\n   {\n       switch (event.keyCode)\n       {\n           case 13:\n               if (window.newMessage && window.newMessage.trim() != \"\")\n               {\n                   let message = new Message();\n            \n                   message.fromId = this.userId;\n                   message.toId = window.participant.id;\n                   message.message = window.newMessage;\n                   message.dateSent = new Date();\n       \n                   window.messages.push(message);\n       \n                   this.onMessageSent.emit(message);\n       \n                   window.newMessage = \"\"; // Resets the new message input\n       \n                   this.scrollChatWindow(window, ScrollDirection.Bottom);\n               }\n               break;\n           case 9:\n               event.preventDefault();\n\n               this.onTabTriggered.emit({ triggeringWindow: window, shiftKeyPressed: event.shiftKey });\n\n               break;\n           case 27:\n               this.onChatWindowClosed.emit({ closedWindow: window, closedViaEscapeKey: true });\n\n               break;\n       }\n   }\n\n    // Toggles a chat window visibility between maximized/minimized\n    onChatWindowClicked(window: Window): void\n    {\n        window.isCollapsed = !window.isCollapsed;\n        this.scrollChatWindow(window, ScrollDirection.Bottom);\n    }\n\n    private clearInUseFileUploader(fileUploadInstanceId: string): void\n    {\n        const uploaderInstanceIdIndex = this.fileUploadersInUse.indexOf(fileUploadInstanceId);\n\n        if (uploaderInstanceIdIndex > -1) {\n            this.fileUploadersInUse.splice(uploaderInstanceIdIndex, 1);\n        }\n    }\n\n    // Handles file selection and uploads the selected file using the file upload adapter\n    onFileChosen(window: Window): void {\n        const fileUploadInstanceId = this.getUniqueFileUploadInstanceId(window);\n        const uploadElementRef = this.nativeFileInput;\n\n        if (uploadElementRef)\n        {\n            const file: File = uploadElementRef.nativeElement.files[0];\n\n            this.fileUploadersInUse.push(fileUploadInstanceId);\n\n            this.fileUploadAdapter.uploadFile(file, window.participant.id)\n                .subscribe(fileMessage => {\n                    this.clearInUseFileUploader(fileUploadInstanceId);\n\n                    fileMessage.fromId = this.userId;\n\n                    // Push file message to current user window   \n                    window.messages.push(fileMessage);\n        \n                    this.onMessageSent.emit(fileMessage);\n        \n                    this.scrollChatWindow(window, ScrollDirection.Bottom);\n\n                    // Resets the file upload element\n                    uploadElementRef.nativeElement.value = '';\n                }, (error) => {\n                    this.clearInUseFileUploader(fileUploadInstanceId);\n\n                    // Resets the file upload element\n                    uploadElementRef.nativeElement.value = '';\n\n                    // TODO: Invoke a file upload adapter error here\n                });\n        }\n    }\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { FormsModule } from '@angular/forms';\nimport { HttpClientModule } from '@angular/common/http';\n\nimport { NgChat } from './ng-chat.component';\nimport { EmojifyPipe } from './pipes/emojify.pipe';\nimport { LinkfyPipe } from './pipes/linkfy.pipe';\nimport { SanitizePipe } from './pipes/sanitize.pipe';\nimport { SecurePipe } from './pipes/secure.pipe';\nimport { GroupMessageDisplayNamePipe } from './pipes/group-message-display-name.pipe';\nimport { NgChatOptionsComponent } from './components/ng-chat-options/ng-chat-options.component';\nimport { NgChatWindowOptionsComponent } from './components/ng-chat-window-options/ng-chat-window-options.component';\nimport { NgChatFriendsListComponent } from './components/ng-chat-friends-list/ng-chat-friends-list.component';\nimport { NgChatWindowComponent } from './components/ng-chat-window/ng-chat-window.component';\n\n@NgModule({\n  imports: [CommonModule, FormsModule, HttpClientModule],\n  declarations: [\n    NgChat, \n    EmojifyPipe, \n    LinkfyPipe, \n    SanitizePipe, \n    SecurePipe,\n    GroupMessageDisplayNamePipe, \n    NgChatOptionsComponent, \n    NgChatWindowOptionsComponent,\n    NgChatFriendsListComponent, \n    NgChatWindowComponent\n  ],\n  exports: [NgChat]\n})\nexport class NgChatModule {\n}\n"]}