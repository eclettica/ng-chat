!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/common"),require("@angular/core"),require("@angular/forms"),require("@angular/common/http"),require("rxjs/operators"),require("@angular/platform-browser"),require("rxjs")):"function"==typeof define&&define.amd?define("ng-chat",["exports","@angular/common","@angular/core","@angular/forms","@angular/common/http","rxjs/operators","@angular/platform-browser","rxjs"],e):e((t=t||self)["ng-chat"]={},t.ng.common,t.ng.core,t.ng.forms,t.ng.common.http,t.rxjs.operators,t.ng.platformBrowser,t.rxjs)}(this,(function(t,e,i,n,o,a,s,r){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var p=function(t,e){return(p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};function c(t,e,i,n){var o,a=arguments.length,s=a<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var r=t.length-1;r>=0;r--)(o=t[r])&&(s=(a<3?o(s):a>3?o(e,i,s):o(e,i))||s);return a>3&&s&&Object.defineProperty(e,i,s),s}function d(t,e,i,n){return new(i||(i=Promise))((function(o,a){function s(t){try{p(n.next(t))}catch(t){a(t)}}function r(t){try{p(n.throw(t))}catch(t){a(t)}}function p(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,r)}p((n=n.apply(t,e||[])).next())}))}function l(t,e){var i,n,o,a,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function r(a){return function(r){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,n=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],n=0}finally{i=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,r])}}}var h,g=function(){function t(){this.friendsListChangedHandler=function(t){},this.messageReceivedHandler=function(t,e){}}return t.prototype.onFriendsListChanged=function(t){this.friendsListChangedHandler(t)},t.prototype.onMessageReceived=function(t,e){this.messageReceivedHandler(t,e)},t}();(h=t.MessageType||(t.MessageType={}))[h.Text=1]="Text",h[h.File=2]="File",h[h.Image=3]="Image";var u,f,m=function(){this.type=t.MessageType.Text};(u=t.ChatParticipantStatus||(t.ChatParticipantStatus={}))[u.Online=0]="Online",u[u.Busy=1]="Busy",u[u.Away=2]="Away",u[u.Offline=3]="Offline",(f=t.ChatParticipantType||(t.ChatParticipantType={}))[f.User=0]="User",f[f.Group=1]="Group";var w,y=function(){this.participantType=t.ChatParticipantType.User},v=function(){},b=function(){this.totalUnreadMessages=0},x=function(t,e,i){this.messages=[],this.newMessage="",this.isCollapsed=!1,this.isLoadingHistory=!1,this.hasFocus=!1,this.hasMoreMessages=!0,this.historyPage=0,this.participant=t,this.messages=[],this.isLoadingHistory=e,this.hasFocus=!1,this.isCollapsed=i,this.hasMoreMessages=!1,this.historyPage=0},C=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return function(t,e){function i(){this.constructor=t}p(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}(e,t),e}(g);(w=t.Theme||(t.Theme={})).Custom="custom-theme",w.Light="light-theme",w.Dark="dark-theme";var I,k=function(){function t(){}return t.newGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))},t}(),P=function(e){this.id=k.newGuid(),this.participantType=t.ChatParticipantType.Group,this.chattingTo=e,this.status=t.ChatParticipantStatus.Online,this.displayName=e.map((function(t){return t.displayName})).sort((function(t,e){return e>t?-1:1})).join(", ")};!function(t){t[t.Top=0]="Top",t[t.Bottom=1]="Bottom"}(I||(I={}));var T=function(){function t(t,e){this._serverEndpointUrl=t,this._http=e}return t.prototype.uploadFile=function(t,e){var i=new FormData;return i.append("ng-chat-participant-id",e),i.append("file",t,t.name),this._http.post(this._serverEndpointUrl,i)},t}(),F=function(){function e(e){this._httpClient=e,this.ChatParticipantType=t.ChatParticipantType,this.ChatParticipantStatus=t.ChatParticipantStatus,this.MessageType=t.MessageType,this._isDisabled=!1,this.isCollapsed=!1,this.maximizeWindowOnNewMessage=!0,this.pollFriendsList=!1,this.pollingInterval=5e3,this.historyEnabled=!0,this.emojisEnabled=!0,this.linkfyEnabled=!0,this.audioEnabled=!0,this.searchEnabled=!0,this.audioSource="https://raw.githubusercontent.com/rpaschoal/ng-chat/master/src/ng-chat/assets/notification.wav",this.persistWindowsState=!0,this.title="Friends",this.messagePlaceholder="Type a message",this.searchPlaceholder="Search",this.browserNotificationsEnabled=!0,this.browserNotificationIconSource="https://raw.githubusercontent.com/rpaschoal/ng-chat/master/src/ng-chat/assets/notification.png",this.browserNotificationTitle="New message from",this.historyPageSize=10,this.hideFriendsList=!1,this.hideFriendsListOnUnsupportedViewport=!0,this.theme=t.Theme.Light,this.messageDatePipeFormat="short",this.showMessageDate=!0,this.isViewportOnMobileEnabled=!1,this.onParticipantClicked=new i.EventEmitter,this.onParticipantChatOpened=new i.EventEmitter,this.onParticipantChatClosed=new i.EventEmitter,this.onMessagesSeen=new i.EventEmitter,this.browserNotificationsBootstrapped=!1,this.hasPagedHistory=!1,this.statusDescription={online:"Online",busy:"Busy",away:"Away",offline:"Offline"},this.participantsInteractedWith=[],this.windowSizeFactor=320,this.friendsListWidth=262,this.unsupportedViewport=!1,this.windows=[],this.isBootstrapped=!1}return Object.defineProperty(e.prototype,"isDisabled",{get:function(){return this._isDisabled},set:function(t){this._isDisabled=t,t?window.clearInterval(this.pollingIntervalWindowInstance):this.activateFriendListFetch()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"localStorageKey",{get:function(){return"ng-chat-users-"+this.userId},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){this.bootstrapChat()},e.prototype.onResize=function(t){this.viewPortTotalArea=t.target.innerWidth,this.NormalizeWindows()},e.prototype.NormalizeWindows=function(){var t=Math.floor((this.viewPortTotalArea-(this.hideFriendsList?0:this.friendsListWidth))/this.windowSizeFactor),e=this.windows.length-t;e>=0&&this.windows.splice(this.windows.length-e),this.updateWindowsState(this.windows),this.unsupportedViewport=!this.isViewportOnMobileEnabled&&(this.hideFriendsListOnUnsupportedViewport&&t<1)},e.prototype.bootstrapChat=function(){var t=this,e=null;if(null!=this.adapter&&null!=this.userId)try{this.viewPortTotalArea=window.innerWidth,this.initializeTheme(),this.initializeDefaultText(),this.initializeBrowserNotifications(),this.adapter.messageReceivedHandler=function(e,i){return t.onMessageReceived(e,i)},this.adapter.friendsListChangedHandler=function(e){return t.onFriendsListChanged(e)},this.activateFriendListFetch(),this.bufferAudioFile(),this.hasPagedHistory=this.adapter instanceof C,this.fileUploadUrl&&""!==this.fileUploadUrl&&(this.fileUploadAdapter=new T(this.fileUploadUrl,this._httpClient)),this.NormalizeWindows(),this.isBootstrapped=!0}catch(t){e=t}this.isBootstrapped||(console.error("ng-chat component couldn't be bootstrapped."),null==this.userId&&console.error("ng-chat can't be initialized without an user id. Please make sure you've provided an userId as a parameter of the ng-chat component."),null==this.adapter&&console.error("ng-chat can't be bootstrapped without a ChatAdapter. Please make sure you've provided a ChatAdapter implementation as a parameter of the ng-chat component."),e&&(console.error("An exception has occurred while initializing ng-chat. Details: "+e.message),console.error(e)))},e.prototype.activateFriendListFetch=function(){var t=this;this.adapter&&(this.pollFriendsList?(this.fetchFriendsList(!0),this.pollingIntervalWindowInstance=window.setInterval((function(){return t.fetchFriendsList(!1)}),this.pollingInterval)):this.fetchFriendsList(!0))},e.prototype.initializeBrowserNotifications=function(){return d(this,void 0,void 0,(function(){return l(this,(function(t){switch(t.label){case 0:return this.browserNotificationsEnabled&&"Notification"in window?[4,Notification.requestPermission()]:[3,2];case 1:"granted"===t.sent()&&(this.browserNotificationsBootstrapped=!0),t.label=2;case 2:return[2]}}))}))},e.prototype.initializeDefaultText=function(){this.localization||(this.localization={messagePlaceholder:this.messagePlaceholder,searchPlaceholder:this.searchPlaceholder,title:this.title,statusDescription:this.statusDescription,browserNotificationTitle:this.browserNotificationTitle,loadMessageHistoryPlaceholder:"Load older messages"})},e.prototype.initializeTheme=function(){if(this.customTheme)this.theme=t.Theme.Custom;else if(this.theme!=t.Theme.Light&&this.theme!=t.Theme.Dark)throw new Error('Invalid theme configuration for ng-chat. "'+this.theme+'" is not a valid theme value.')},e.prototype.fetchFriendsList=function(t){var e=this;this.adapter.listFriends().pipe(a.map((function(t){e.participantsResponse=t,e.participants=t.map((function(t){return t.participant}))}))).subscribe((function(){t&&e.restoreWindowsState()}))},e.prototype.fetchMessageHistory=function(t){var e=this;this.adapter instanceof C?(t.isLoadingHistory=!0,this.adapter.getMessageHistoryByPage(t.participant.id,this.historyPageSize,++t.historyPage).pipe(a.map((function(i){i.forEach((function(t){return e.assertMessageType(t)})),t.messages=i.concat(t.messages),t.isLoadingHistory=!1;var n=1==t.historyPage?I.Bottom:I.Top;t.hasMoreMessages=i.length==e.historyPageSize,setTimeout((function(){return e.onFetchMessageHistoryLoaded(i,t,n,!0)}))}))).subscribe()):this.adapter.getMessageHistory(t.participant.id).pipe(a.map((function(i){i.forEach((function(t){return e.assertMessageType(t)})),t.messages=i.concat(t.messages),t.isLoadingHistory=!1,setTimeout((function(){return e.onFetchMessageHistoryLoaded(i,t,I.Bottom)}))}))).subscribe()},e.prototype.onFetchMessageHistoryLoaded=function(t,e,i,n){if(void 0===n&&(n=!1),this.scrollChatWindow(e,i),e.hasFocus||n){var o=t.filter((function(t){return!t.dateSeen}));this.markMessagesAsRead(o)}},e.prototype.onFriendsListChanged=function(t){t&&(this.participantsResponse=t,this.participants=t.map((function(t){return t.participant})),this.participantsInteractedWith=[])},e.prototype.onMessageReceived=function(t,e){if(t&&e){var i=this.openChatWindow(t);this.assertMessageType(e),i[1]&&this.historyEnabled||(i[0].messages.push(e),this.scrollChatWindow(i[0],I.Bottom),i[0].hasFocus&&this.markMessagesAsRead([e])),this.emitMessageSound(i[0]),(this.maximizeWindowOnNewMessage||!i[1]&&!i[0].isCollapsed)&&this.emitBrowserNotification(i[0],e)}},e.prototype.onParticipantClickedFromFriendsList=function(t){this.openChatWindow(t,!0,!0)},e.prototype.cancelOptionPrompt=function(){this.currentActiveOption&&(this.currentActiveOption.isActive=!1,this.currentActiveOption=null)},e.prototype.onOptionPromptCanceled=function(){this.cancelOptionPrompt()},e.prototype.onOptionPromptConfirmed=function(t){this.confirmNewGroup(t),this.cancelOptionPrompt()},e.prototype.confirmNewGroup=function(t){var e=new P(t);this.openChatWindow(e),this.groupAdapter&&this.groupAdapter.groupCreated(e)},e.prototype.openChatWindow=function(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=!1);var n=this.windows.find((function(e){return e.participant.id==t.id}));if(n)return[n,!1];i&&this.onParticipantClicked.emit(t);var o=!i&&!this.maximizeWindowOnNewMessage,a=new x(t,this.historyEnabled,o);return this.historyEnabled&&this.fetchMessageHistory(a),this.windows.unshift(a),this.isViewportOnMobileEnabled||this.windows.length*this.windowSizeFactor>=this.viewPortTotalArea-(this.hideFriendsList?0:this.friendsListWidth)&&this.windows.pop(),this.updateWindowsState(this.windows),e&&!o&&this.focusOnWindow(a),this.participantsInteractedWith.push(t),this.onParticipantChatOpened.emit(t),[a,!0]},e.prototype.focusOnWindow=function(t,e){var i=this;void 0===e&&(e=function(){});var n=this.windows.indexOf(t);n>=0&&setTimeout((function(){i.chatWindows&&i.chatWindows.toArray()[n].chatWindowInput.nativeElement.focus();e()}))},e.prototype.assertMessageType=function(e){e.type||(e.type=t.MessageType.Text)},e.prototype.markMessagesAsRead=function(t){var e=new Date;t.forEach((function(t){t.dateSeen=e})),this.onMessagesSeen.emit(t)},e.prototype.bufferAudioFile=function(){this.audioSource&&this.audioSource.length>0&&(this.audioFile=new Audio,this.audioFile.src=this.audioSource,this.audioFile.load())},e.prototype.emitMessageSound=function(t){this.audioEnabled&&!t.hasFocus&&this.audioFile&&this.audioFile.play()},e.prototype.emitBrowserNotification=function(t,e){if(this.browserNotificationsBootstrapped&&!t.hasFocus&&e){var i=new Notification(this.localization.browserNotificationTitle+" "+t.participant.displayName,{body:e.message,icon:this.browserNotificationIconSource});setTimeout((function(){i.close()}),e.message.length<=50?5e3:7e3)}},e.prototype.updateWindowsState=function(t){if(this.persistWindowsState){var e=t.map((function(t){return t.participant.id}));localStorage.setItem(this.localStorageKey,JSON.stringify(e))}},e.prototype.restoreWindowsState=function(){var t=this;try{if(this.persistWindowsState){var e=localStorage.getItem(this.localStorageKey);if(e&&e.length>0){var i=JSON.parse(e);this.participants.filter((function(t){return i.indexOf(t.id)>=0})).forEach((function(e){t.openChatWindow(e)}))}}}catch(t){console.error("An error occurred while restoring ng-chat windows state. Details: "+t)}},e.prototype.getClosestWindow=function(t){var e=this.windows.indexOf(t);return e>0?this.windows[e-1]:0==e&&this.windows.length>1?this.windows[e+1]:void 0},e.prototype.closeWindow=function(t){var e=this.windows.indexOf(t);this.windows.splice(e,1),this.updateWindowsState(this.windows),this.onParticipantChatClosed.emit(t.participant)},e.prototype.getChatWindowComponentInstance=function(t){var e=this.windows.indexOf(t);return this.chatWindows?this.chatWindows.toArray()[e]:null},e.prototype.scrollChatWindow=function(t,e){var i=this.getChatWindowComponentInstance(t);i&&i.scrollChatWindow(t,e)},e.prototype.onWindowMessagesSeen=function(t){this.markMessagesAsRead(t)},e.prototype.onWindowChatClosed=function(t){var e=this,i=t.closedWindow,n=t.closedViaEscapeKey;if((console.log("onWindowChatClosed"),null!=this.beforeParteciantChatClosed&&this.beforeParteciantChatClosed)&&0==this.beforeParteciantChatClosed(i.participant))return;if(n){var o=this.getClosestWindow(i);o?this.focusOnWindow(o,(function(){e.closeWindow(i)})):this.closeWindow(i)}else this.closeWindow(i)},e.prototype.onWindowTabTriggered=function(t){var e=t.triggeringWindow,i=t.shiftKeyPressed,n=this.windows.indexOf(e),o=this.windows[n+(i?1:-1)];o||(o=this.windows[n>0?0:this.chatWindows.length-1]),this.focusOnWindow(o)},e.prototype.onWindowMessageSent=function(t){this.adapter.sendMessage(t)},e.prototype.onWindowOptionTriggered=function(t){this.currentActiveOption=t},e.prototype.triggerOpenChatWindow=function(t){t&&this.openChatWindow(t)},e.prototype.triggerCloseChatWindow=function(t){var e=this.windows.find((function(e){return e.participant.id==t}));e&&this.closeWindow(e)},e.prototype.triggerToggleChatWindowVisibility=function(t){var e=this.windows.find((function(e){return e.participant.id==t}));if(e){var i=this.getChatWindowComponentInstance(e);i&&i.onChatWindowClicked(e)}},e.prototype.setBeforeParteciantChatClosed=function(t){this.beforeParteciantChatClosed=t},e.ctorParameters=function(){return[{type:o.HttpClient}]},c([i.Input()],e.prototype,"isDisabled",null),c([i.Input()],e.prototype,"adapter",void 0),c([i.Input()],e.prototype,"groupAdapter",void 0),c([i.Input()],e.prototype,"userId",void 0),c([i.Input()],e.prototype,"isCollapsed",void 0),c([i.Input()],e.prototype,"maximizeWindowOnNewMessage",void 0),c([i.Input()],e.prototype,"pollFriendsList",void 0),c([i.Input()],e.prototype,"pollingInterval",void 0),c([i.Input()],e.prototype,"historyEnabled",void 0),c([i.Input()],e.prototype,"emojisEnabled",void 0),c([i.Input()],e.prototype,"linkfyEnabled",void 0),c([i.Input()],e.prototype,"audioEnabled",void 0),c([i.Input()],e.prototype,"searchEnabled",void 0),c([i.Input()],e.prototype,"audioSource",void 0),c([i.Input()],e.prototype,"persistWindowsState",void 0),c([i.Input()],e.prototype,"title",void 0),c([i.Input()],e.prototype,"messagePlaceholder",void 0),c([i.Input()],e.prototype,"searchPlaceholder",void 0),c([i.Input()],e.prototype,"browserNotificationsEnabled",void 0),c([i.Input()],e.prototype,"browserNotificationIconSource",void 0),c([i.Input()],e.prototype,"browserNotificationTitle",void 0),c([i.Input()],e.prototype,"historyPageSize",void 0),c([i.Input()],e.prototype,"localization",void 0),c([i.Input()],e.prototype,"hideFriendsList",void 0),c([i.Input()],e.prototype,"hideFriendsListOnUnsupportedViewport",void 0),c([i.Input()],e.prototype,"fileUploadUrl",void 0),c([i.Input()],e.prototype,"theme",void 0),c([i.Input()],e.prototype,"customTheme",void 0),c([i.Input()],e.prototype,"messageDatePipeFormat",void 0),c([i.Input()],e.prototype,"showMessageDate",void 0),c([i.Input()],e.prototype,"isViewportOnMobileEnabled",void 0),c([i.Output()],e.prototype,"onParticipantClicked",void 0),c([i.Output()],e.prototype,"onParticipantChatOpened",void 0),c([i.Output()],e.prototype,"onParticipantChatClosed",void 0),c([i.Output()],e.prototype,"onMessagesSeen",void 0),c([i.ViewChildren("chatWindow")],e.prototype,"chatWindows",void 0),c([i.HostListener("window:resize",["$event"])],e.prototype,"onResize",null),e=c([i.Component({selector:"ng-chat",template:'<link *ngIf="customTheme" rel="stylesheet" [href]=\'customTheme | sanitize\'>\n\n<div id="ng-chat" *ngIf="!isDisabled && isBootstrapped && !unsupportedViewport" [ngClass]="theme">\n    <ng-chat-friends-list\n        [localization]="localization"\n        [shouldDisplay]="!hideFriendsList"\n        [userId]="userId"\n        [isCollapsed]="isCollapsed"\n        [searchEnabled]="searchEnabled"\n        [participants]="participants"\n        [participantsResponse]="participantsResponse"\n        [participantsInteractedWith]="participantsInteractedWith"\n        [windows]="windows"\n        [currentActiveOption]="currentActiveOption"\n        (onParticipantClicked)="onParticipantClickedFromFriendsList($event)"\n        (onOptionPromptCanceled)="onOptionPromptCanceled()"\n        (onOptionPromptConfirmed)="onOptionPromptConfirmed($event)"\n    >\n    </ng-chat-friends-list>\n\n    <div *ngFor="let window of windows; let i = index" [ngClass]="{\'ng-chat-window\': true, \'primary-outline-color\': true, \'ng-chat-window-collapsed\': window.isCollapsed}" [ngStyle]="{\'right\': (!hideFriendsList ? friendsListWidth : 0) + 20 + windowSizeFactor * i + \'px\'}">\n        <ng-chat-window\n            #chatWindow\n            [fileUploadAdapter]="fileUploadAdapter"\n            [localization]="localization"\n            [userId]="userId"\n            [window]="window"\n            [showOptions]="groupAdapter"\n            [emojisEnabled]="emojisEnabled"\n            [linkfyEnabled]="linkfyEnabled"\n            [showMessageDate]="showMessageDate"\n            [messageDatePipeFormat]="messageDatePipeFormat"\n            [hasPagedHistory]="hasPagedHistory"\n            (onMessagesSeen)="onWindowMessagesSeen($event)"\n            (onMessageSent)="onWindowMessageSent($event)"\n            (onTabTriggered)="onWindowTabTriggered($event)"\n            (onChatWindowClosed)="onWindowChatClosed($event)"\n            (onOptionTriggered)="onWindowOptionTriggered($event)"\n            (onLoadHistoryTriggered)="fetchMessageHistory($event)"\n        >\n        </ng-chat-window>\n    </div>\n</div>\n',encapsulation:i.ViewEncapsulation.None,styles:[".user-icon{box-sizing:border-box;background-color:#fff;border:2px solid;width:32px;height:20px;border-radius:64px 64px 0 0/64px;margin-top:14px;margin-left:-1px;display:inline-block;vertical-align:middle;position:relative;font-style:normal;color:#ddd;text-align:left;text-indent:-9999px}.user-icon:before{border:2px solid;background-color:#fff;width:12px;height:12px;top:-19px;border-radius:50%;position:absolute;left:50%;transform:translateX(-50%)}.user-icon:after,.user-icon:before{content:'';pointer-events:none}.upload-icon{position:absolute;margin-left:3px;margin-top:12px;width:13px;height:4px;border:1px solid currentColor;border-top:none;border-radius:1px}.upload-icon:before{content:'';position:absolute;top:-8px;left:6px;width:1px;height:9px;background-color:currentColor}.upload-icon:after{content:'';position:absolute;top:-8px;left:4px;width:4px;height:4px;border-top:1px solid currentColor;border-right:1px solid currentColor;transform:rotate(-45deg)}.paperclip-icon{position:absolute;margin-left:9px;margin-top:2px;width:6px;height:12px;border-radius:4px 4px 0 0;border-left:1px solid currentColor;border-right:1px solid currentColor;border-top:1px solid currentColor;transform:rotate(45deg)}.paperclip-icon:before{content:'';position:absolute;top:11px;left:-1px;width:4px;height:6px;border-radius:0 0 3px 3px;border-left:1px solid currentColor;border-right:1px solid currentColor;border-bottom:1px solid currentColor}.paperclip-icon:after{content:'';position:absolute;left:1px;top:1px;width:2px;height:10px;border-radius:4px 4px 0 0;border-left:1px solid currentColor;border-right:1px solid currentColor;border-top:1px solid currentColor}.check-icon{color:#000;position:absolute;margin-left:3px;margin-top:4px;width:14px;height:8px;border-bottom:1px solid currentColor;border-left:1px solid currentColor;transform:rotate(-45deg)}.remove-icon{color:#000;position:absolute;margin-left:3px;margin-top:10px}.remove-icon:before{content:'';position:absolute;width:15px;height:1px;background-color:currentColor;transform:rotate(45deg)}.remove-icon:after{content:'';position:absolute;width:15px;height:1px;background-color:currentColor;transform:rotate(-45deg)}",".loader,.loader:after,.loader:before{background:#e3e3e3;-webkit-animation:1s ease-in-out infinite load1;animation:1s ease-in-out infinite load1;width:1em;height:4em}.loader{color:#e3e3e3;text-indent:-9999em;margin:4px auto 0;position:relative;font-size:4px;transform:translateZ(0);-webkit-animation-delay:-.16s;animation-delay:-.16s}.loader:after,.loader:before{position:absolute;top:0;content:''}.loader:before{left:-1.5em;-webkit-animation-delay:-.32s;animation-delay:-.32s}.loader:after{left:1.5em}@-webkit-keyframes load1{0%,100%,80%{box-shadow:0 0;height:4em}40%{box-shadow:0 -2em;height:5em}}@keyframes load1{0%,100%,80%{box-shadow:0 0;height:4em}40%{box-shadow:0 -2em;height:5em}}","#ng-chat{position:fixed;z-index:999;right:0;bottom:0;box-sizing:initial;font-size:11pt;text-align:left}#ng-chat .shadowed{box-shadow:0 4px 8px rgba(0,0,0,.25)}.ng-chat-loading-wrapper{height:30px;text-align:center;font-size:.9em}.ng-chat-close{text-decoration:none;float:right}.ng-chat-title,.ng-chat-title:hover{position:relative;z-index:2;height:30px;line-height:30px;font-size:.9em;padding:0 10px;display:block;text-decoration:none;color:inherit;font-weight:400;cursor:pointer}.ng-chat-title .ng-chat-title-visibility-toggle-area{display:inline-block;width:85%}.ng-chat-title .ng-chat-title-visibility-toggle-area>strong{font-weight:600;display:block;overflow:hidden;height:30px;text-overflow:ellipsis;white-space:nowrap;max-width:85%;float:left}.ng-chat-title .ng-chat-title-visibility-toggle-area .ng-chat-participant-status{float:left;margin-left:5px}.ng-chat-participant-status{display:inline-block;border-radius:25px;width:8px;height:8px;margin-top:10px}.ng-chat-participant-status.online{background-color:#92a400}.ng-chat-participant-status.busy{background-color:#f91c1e}.ng-chat-participant-status.away{background-color:#f7d21b}.ng-chat-participant-status.offline{background-color:#bababa}.ng-chat-unread-messages-count{margin-left:5px;padding:0 5px;border-radius:25px;font-size:.9em;line-height:30px}.ng-chat-options-container{float:right;margin-right:5px}","#ng-chat.light-theme,#ng-chat.light-theme .primary-text{color:#5c5c5c;font-family:Arial,Helvetica,sans-serif}#ng-chat.light-theme .primary-background{background-color:#fff}#ng-chat.light-theme .secondary-background{background-color:#fafafa}#ng-chat.light-theme .primary-outline-color{border-color:#a3a3a3}#ng-chat.light-theme .friends-search-bar{background-color:#fff}#ng-chat.light-theme .ng-chat-people-action,#ng-chat.light-theme .ng-chat-people-action>i,#ng-chat.light-theme .unread-messages-counter-container{color:#5c5c5c;background-color:#e3e3e3}#ng-chat.light-theme .load-history-action{background-color:#e3e3e3}#ng-chat.light-theme .chat-window-input{background-color:#fff}#ng-chat.light-theme .file-message-container,#ng-chat.light-theme .sent-chat-message-container{background-color:#e3e3e3;border-color:#e3e3e3}#ng-chat.light-theme .file-message-container.received,#ng-chat.light-theme .received-chat-message-container{background-color:#fff;border-color:#e3e3e3}","#ng-chat.dark-theme,#ng-chat.dark-theme .primary-text{color:#fff;font-family:Arial,Helvetica,sans-serif}#ng-chat.dark-theme .primary-background{background-color:#565656}#ng-chat.dark-theme .secondary-background{background-color:#444}#ng-chat.dark-theme .primary-outline-color{border-color:#353535}#ng-chat.dark-theme .friends-search-bar{background-color:#444;border:1px solid #444;color:#fff}#ng-chat.dark-theme .ng-chat-people-action,#ng-chat.dark-theme .ng-chat-people-action>i,#ng-chat.dark-theme .unread-messages-counter-container{background-color:#fff;color:#444}#ng-chat.dark-theme .load-history-action{background-color:#444}#ng-chat.dark-theme .chat-window-input{background-color:#444;color:#fff}#ng-chat.dark-theme .file-message-container,#ng-chat.dark-theme .sent-chat-message-container{border-color:#444;background-color:#444}#ng-chat.dark-theme .file-message-container.received,#ng-chat.dark-theme .received-chat-message-container{background-color:#565656;border-color:#444}#ng-chat.dark-theme .ng-chat-footer{background-color:#444}#ng-chat.dark-theme .ng-chat-message a{color:#fff}"]})],e)}(),O=[{patterns:[":)",":-)","=)"],unicode:"😃"},{patterns:[":D",":-D","=D"],unicode:"😀"},{patterns:[":(",":-(","=("],unicode:"🙁"},{patterns:[":|",":-|","=|"],unicode:"😐"},{patterns:[":*",":-*","=*"],unicode:"😙"},{patterns:["T_T","T.T"],unicode:"😭"},{patterns:[":O",":-O","=O",":o",":-o","=o"],unicode:"😮"},{patterns:[":P",":-P","=P",":p",":-p","=p"],unicode:"😋"},{patterns:[">.<"],unicode:"😣"},{patterns:["@.@"],unicode:"😵"},{patterns:["*.*"],unicode:"😍"},{patterns:["<3"],unicode:"❤️"},{patterns:["^.^"],unicode:"😊"},{patterns:[":+1"],unicode:"👍"},{patterns:[":-1"],unicode:"👎"}],M=function(){function t(){}return t.prototype.transform=function(t,e){return e&&t&&t.length>1&&O.forEach((function(e){e.patterns.forEach((function(i){t=t.replace(i,e.unicode)}))})),t},t=c([i.Pipe({name:"emojify"})],t)}(),W=function(){function t(){}return t.prototype.transform=function(t,e){if(e&&t&&t.length>1){var i,n,o;return i=/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,n=/(^|[^\/])(www\.[\S]+(\b|$))/gim,o=/(([a-zA-Z0-9\-\_\.])+@[a-zA-Z\_]+?(\.[a-zA-Z]{2,6})+)/gim,t.replace(i,'<a href="$1" target="_blank">$1</a>').replace(n,'$1<a href="http://$2" target="_blank">$2</a>').replace(o,'<a href="mailto:$1">$1</a>')}return t},t=c([i.Pipe({name:"linkfy"})],t)}(),S=function(){function t(t){this.sanitizer=t}return t.prototype.transform=function(t){return this.sanitizer.bypassSecurityTrustResourceUrl(t)},t.ctorParameters=function(){return[{type:s.DomSanitizer}]},t=c([i.Pipe({name:"sanitize"})],t)}(),A=function(){function t(t){this.http=t}return t.prototype.transform=function(t){var e=this;return new r.Observable((function(i){i.next("data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==");i.next,i.error;return console.log("secure pipe"),e.http.get(t,{responseType:"blob"}).subscribe((function(t){var e=new FileReader;e.readAsDataURL(t),e.onloadend=function(){null!=e.result&&i.next(e.result)}})),{unsubscribe:function(){}}}))},t.ctorParameters=function(){return[{type:o.HttpClient}]},t=c([i.Pipe({name:"secure"})],t)}(),E=function(){function e(){}return e.prototype.transform=function(e,i){if(e&&e.participantType==t.ChatParticipantType.Group){var n=e,o=n.chattingTo.findIndex((function(t){return t.id==i.fromId}));return n.chattingTo[o>=0?o:0].displayName}return""},e=c([i.Pipe({name:"groupMessageDisplayName"})],e)}(),U=function(){function t(){this.activeOptionTrackerChange=new i.EventEmitter}return t.prototype.onOptionClicked=function(t){t.isActive=!0,t.action&&t.action(t.chattingTo),this.activeOptionTrackerChange.emit(t)},c([i.Input()],t.prototype,"options",void 0),c([i.Input()],t.prototype,"activeOptionTracker",void 0),c([i.Output()],t.prototype,"activeOptionTrackerChange",void 0),t=c([i.Component({selector:"ng-chat-options",template:'<div *ngIf="options && options.length > 0" class="ng-chat-options">\n\t\t<button class="ng-chat-options-activator">\n\t\t\t<span class="primary-text">...</span>\n\t\t</button>\n\t<div class="ng-chat-options-content primary-background shadowed">\n\t\t<a *ngFor="let option of options; let i = index" [ngClass]="\'primary-text\'" (click)="onOptionClicked(option)">\n\t\t\t{{option.displayLabel}}\n\t\t</a>\n\t</div>      \n</div>\n',styles:[".ng-chat-options-activator{background-color:unset;color:#fff;line-height:28px;border:none;position:relative}.ng-chat-options-activator>span{position:relative;top:-5px;left:0}.ng-chat-options{position:relative;display:inline-block}.ng-chat-options:hover .ng-chat-options-content{display:block}.ng-chat-options:hover .ng-chat-options-activator{background-color:#ddd}.ng-chat-options-content{display:none;position:absolute;min-width:160px;z-index:1}.ng-chat-options-content a:hover{background-color:#ddd}.ng-chat-options-content a{padding:6px 16px;text-decoration:none;display:block}@media only screen and (max-width:581px){.ng-chat-options-content{right:0}}"]})],t)}(),z=function(){function t(){}return t.formatUnreadMessagesTotal=function(t){return t>0?t>99?"99+":String(t):""},t.unreadMessagesTotal=function(e,i){var n=0;return e&&(n=e.messages.filter((function(t){return t.fromId!=i&&!t.dateSeen})).length),t.formatUnreadMessagesTotal(n)},t}();function L(e,i){var n=t.ChatParticipantStatus[e].toString().toLowerCase();return i.statusDescription[n]}var D=function(){function e(){var e=this;this.participantsInteractedWith=[],this.onParticipantClicked=new i.EventEmitter,this.onOptionPromptCanceled=new i.EventEmitter,this.onOptionPromptConfirmed=new i.EventEmitter,this.selectedUsersFromFriendsList=[],this.searchInput="",this.ChatParticipantStatus=t.ChatParticipantStatus,this.chatParticipantStatusDescriptor=L,this.cleanUpUserSelection=function(){return e.selectedUsersFromFriendsList=[]}}return e.prototype.ngOnChanges=function(t){if(this.currentActiveOption){var e=this.currentActiveOption&&this.currentActiveOption.chattingTo.participant.id;this.selectedUsersFromFriendsList.filter((function(t){return t.id==e})).length>0||(this.selectedUsersFromFriendsList=this.selectedUsersFromFriendsList.concat(this.currentActiveOption.chattingTo.participant))}},Object.defineProperty(e.prototype,"filteredParticipants",{get:function(){var t=this;return this.searchInput.length>0?this.participants.filter((function(e){return e.displayName.toUpperCase().includes(t.searchInput.toUpperCase())})):this.participants},enumerable:!0,configurable:!0}),e.prototype.isUserSelectedFromFriendsList=function(t){return this.selectedUsersFromFriendsList.filter((function(e){return e.id==t.id})).length>0},e.prototype.unreadMessagesTotalByParticipant=function(t){var e=this,i=this.windows.find((function(e){return e.participant.id==t.id}));if(i)return z.unreadMessagesTotal(i,this.userId);var n=this.participantsResponse.filter((function(i){return i.participant.id==t.id&&!e.participantsInteractedWith.find((function(e){return e.id==t.id}))&&i.metadata&&i.metadata.totalUnreadMessages>0})).map((function(t){return t.metadata.totalUnreadMessages}))[0];return z.formatUnreadMessagesTotal(n)},e.prototype.onChatTitleClicked=function(){this.isCollapsed=!this.isCollapsed},e.prototype.onFriendsListCheckboxChange=function(t,e){e?this.selectedUsersFromFriendsList.push(t):this.selectedUsersFromFriendsList.splice(this.selectedUsersFromFriendsList.indexOf(t),1)},e.prototype.onUserClick=function(t){this.onParticipantClicked.emit(t)},e.prototype.onFriendsListActionCancelClicked=function(){this.onOptionPromptCanceled.emit(),this.cleanUpUserSelection()},e.prototype.onFriendsListActionConfirmClicked=function(){this.onOptionPromptConfirmed.emit(this.selectedUsersFromFriendsList),this.cleanUpUserSelection()},c([i.Input()],e.prototype,"participants",void 0),c([i.Input()],e.prototype,"participantsResponse",void 0),c([i.Input()],e.prototype,"participantsInteractedWith",void 0),c([i.Input()],e.prototype,"windows",void 0),c([i.Input()],e.prototype,"userId",void 0),c([i.Input()],e.prototype,"localization",void 0),c([i.Input()],e.prototype,"shouldDisplay",void 0),c([i.Input()],e.prototype,"isCollapsed",void 0),c([i.Input()],e.prototype,"searchEnabled",void 0),c([i.Input()],e.prototype,"currentActiveOption",void 0),c([i.Output()],e.prototype,"onParticipantClicked",void 0),c([i.Output()],e.prototype,"onOptionPromptCanceled",void 0),c([i.Output()],e.prototype,"onOptionPromptConfirmed",void 0),e=c([i.Component({selector:"ng-chat-friends-list",template:'<div *ngIf="shouldDisplay" id="ng-chat-people" [ngClass]="{\'primary-outline-color\': true, \'primary-background\': true, \'ng-chat-people-collapsed\': isCollapsed}">\n\t<a href="javascript:void(0);" class="ng-chat-title secondary-background shadowed" (click)="onChatTitleClicked()">\n\t\t<span>\n\t\t\t{{localization.title}}\n\t\t</span>\n\t</a>\n\t<div *ngIf="currentActiveOption" class="ng-chat-people-actions" (click)="onFriendsListActionCancelClicked()">\n\t\t<a href="javascript:void(0);" class="ng-chat-people-action">\n\t\t\t<i class="remove-icon"></i>\n\t\t</a>\n\t\t<a href="javascript:void(0);" class="ng-chat-people-action" (click)="onFriendsListActionConfirmClicked()">\n\t\t\t<i class="check-icon"></i>\n\t\t</a>\n\t</div>\n\t<input *ngIf="searchEnabled" id="ng-chat-search_friend" class="friends-search-bar" type="search" [placeholder]="localization.searchPlaceholder" [(ngModel)]="searchInput" />\n\t<ul id="ng-chat-users" *ngIf="!isCollapsed" [ngClass]="{\'offset-search\': searchEnabled}">\n\t\t<li *ngFor="let user of filteredParticipants">\n\t\t\t<input \n\t\t\t\t*ngIf="currentActiveOption && currentActiveOption.validateContext(user)" \n\t\t\t\ttype="checkbox" \n\t\t\t\tclass="ng-chat-users-checkbox" \n\t\t\t\t(change)="onFriendsListCheckboxChange(user, $event.target.checked)" \n\t\t\t\t[checked]="isUserSelectedFromFriendsList(user)"/>\n\t\t\t<div [ngClass]="{\'ng-chat-friends-list-selectable-offset\': currentActiveOption, \'ng-chat-friends-list-container\': true}" (click)="onUserClick(user)">\n\t\t\t\t<div *ngIf="!user.avatar" class="icon-wrapper">\n\t\t\t\t\t<i class="user-icon"></i>\n\t\t\t\t</div>\n\t\t\t\t<img *ngIf="user.avatar" alt="" class="avatar" height="30" width="30"  [src]="user.avatar | sanitize"/>\n\t\t\t\t<strong title="{{user.displayName}}">{{user.displayName}}</strong>\n\t\t\t\t<span [ngClass]="{\'ng-chat-participant-status\': true, \'online\': user.status == ChatParticipantStatus.Online, \'busy\': user.status == ChatParticipantStatus.Busy, \'away\': user.status == ChatParticipantStatus.Away, \'offline\': user.status == ChatParticipantStatus.Offline}" title="{{chatParticipantStatusDescriptor(user.status, localization)}}"></span>\n\t\t\t\t<span *ngIf="unreadMessagesTotalByParticipant(user).length > 0" class="ng-chat-unread-messages-count unread-messages-counter-container primary-text">{{unreadMessagesTotalByParticipant(user)}}</span>\n\t\t\t</div>\n\t\t</li>\n\t</ul>\n</div>',encapsulation:i.ViewEncapsulation.None,styles:["#ng-chat-people{position:relative;width:240px;height:360px;border-width:1px;border-style:solid;margin-right:20px;box-shadow:0 4px 8px rgba(0,0,0,.25);border-bottom:0}#ng-chat-people.ng-chat-people-collapsed{height:30px}#ng-chat-search_friend{display:block;padding:7px 10px;margin:10px auto 0;width:calc(100% - 20px);font-size:.9em;-webkit-appearance:searchfield}#ng-chat-users{padding:0 10px;list-style:none;margin:0;overflow:auto;position:absolute;top:42px;bottom:0;width:100%;box-sizing:border-box}#ng-chat-users.offset-search{top:84px}#ng-chat-users .ng-chat-users-checkbox{float:left;margin-right:5px;margin-top:8px}#ng-chat-users li{clear:both;margin-bottom:10px;overflow:hidden;cursor:pointer;max-height:30px}#ng-chat-users li>.ng-chat-friends-list-selectable-offset{margin-left:22px}#ng-chat-users li .ng-chat-friends-list-container{display:inline-block;width:100%}#ng-chat-users li>.ng-chat-friends-list-selectable-offset.ng-chat-friends-list-container{display:block;width:auto}#ng-chat-users li .ng-chat-friends-list-container>.icon-wrapper,#ng-chat-users li .ng-chat-friends-list-container>img.avatar{float:left;margin-right:5px;border-radius:25px}#ng-chat-users li .ng-chat-friends-list-container>.icon-wrapper{background-color:#bababa;overflow:hidden;width:30px;height:30px}#ng-chat-users li .ng-chat-friends-list-container>.icon-wrapper>i{color:#fff;transform:scale(.7)}#ng-chat-users li .ng-chat-friends-list-container>strong{float:left;line-height:30px;font-size:.8em;max-width:57%;max-height:30px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}#ng-chat-users li .ng-chat-friends-list-container>.ng-chat-participant-status{float:right}.ng-chat-people-actions{position:absolute;top:4px;right:5px;margin:0;padding:0;z-index:2}.ng-chat-people-actions>a.ng-chat-people-action{display:inline-block;width:21px;height:21px;margin-right:8px;text-decoration:none;border:none;border-radius:25px;padding:1px}@media only screen and (max-width:581px){#ng-chat-people{width:300px;height:360px;margin-right:0}}"]})],e)}(),N=function(){function e(){this.emojisEnabled=!0,this.linkfyEnabled=!0,this.showMessageDate=!0,this.messageDatePipeFormat="short",this.hasPagedHistory=!0,this.onChatWindowClosed=new i.EventEmitter,this.onMessagesSeen=new i.EventEmitter,this.onMessageSent=new i.EventEmitter,this.onTabTriggered=new i.EventEmitter,this.onOptionTriggered=new i.EventEmitter,this.onLoadHistoryTriggered=new i.EventEmitter,this.fileUploadersInUse=[],this.ChatParticipantType=t.ChatParticipantType,this.ChatParticipantStatus=t.ChatParticipantStatus,this.MessageType=t.MessageType,this.chatParticipantStatusDescriptor=L}return e.prototype.defaultWindowOptions=function(e){return this.showOptions&&e.participant.participantType==t.ChatParticipantType.User?[{isActive:!1,chattingTo:e,validateContext:function(e){return e.participantType==t.ChatParticipantType.User},displayLabel:"Add People"}]:[]},e.prototype.isAvatarVisible=function(t,e,i){if(e.fromId!=this.userId){if(0==i)return!0;if(t.messages[i-1].fromId!=e.fromId)return!0}return!1},e.prototype.getChatWindowAvatar=function(e,i){if(e.participantType==t.ChatParticipantType.User)return e.avatar;if(e.participantType==t.ChatParticipantType.Group){var n=e,o=n.chattingTo.findIndex((function(t){return t.id==i.fromId}));return n.chattingTo[o>=0?o:0].avatar}return null},e.prototype.getChatWindowAvatarSrc=function(e,i){return e.participantType==t.ChatParticipantType.User?e.avatarSrc:null},e.prototype.isUploadingFile=function(t){var e=this.getUniqueFileUploadInstanceId(t);return this.fileUploadersInUse.indexOf(e)>-1},e.prototype.getUniqueFileUploadInstanceId=function(t){return t&&t.participant?"ng-chat-file-upload-"+t.participant.id:"ng-chat-file-upload"},e.prototype.unreadMessagesTotal=function(t){return z.unreadMessagesTotal(t,this.userId)},e.prototype.scrollChatWindow=function(t,e){var i=this;t.isCollapsed||setTimeout((function(){if(i.chatMessages){var t=i.chatMessages.nativeElement,n=e===I.Top?0:t.scrollHeight;t.scrollTop=n}}))},e.prototype.activeOptionTrackerChange=function(t){this.onOptionTriggered.emit(t)},e.prototype.triggerNativeFileUpload=function(t){t&&this.nativeFileInput&&this.nativeFileInput.nativeElement.click()},e.prototype.toggleWindowFocus=function(e){var i=this;if(e.hasFocus=!e.hasFocus,e.hasFocus){var n=e.messages.filter((function(n){return null==n.dateSeen&&(n.toId==i.userId||e.participant.participantType===t.ChatParticipantType.Group)}));n&&n.length>0&&this.onMessagesSeen.emit(n)}},e.prototype.markMessagesAsRead=function(t){this.onMessagesSeen.emit(t)},e.prototype.fetchMessageHistory=function(t){this.onLoadHistoryTriggered.emit(t)},e.prototype.onCloseChatWindow=function(){this.onChatWindowClosed.emit({closedWindow:this.window,closedViaEscapeKey:!1})},e.prototype.onChatInputTyped=function(t,e){switch(t.keyCode){case 13:if(e.newMessage&&""!=e.newMessage.trim()){var i=new m;i.fromId=this.userId,i.toId=e.participant.id,i.message=e.newMessage,i.dateSent=new Date,e.messages.push(i),this.onMessageSent.emit(i),e.newMessage="",this.scrollChatWindow(e,I.Bottom)}break;case 9:t.preventDefault(),this.onTabTriggered.emit({triggeringWindow:e,shiftKeyPressed:t.shiftKey});break;case 27:this.onChatWindowClosed.emit({closedWindow:e,closedViaEscapeKey:!0})}},e.prototype.onChatWindowClicked=function(t){t.isCollapsed=!t.isCollapsed,this.scrollChatWindow(t,I.Bottom)},e.prototype.clearInUseFileUploader=function(t){var e=this.fileUploadersInUse.indexOf(t);e>-1&&this.fileUploadersInUse.splice(e,1)},e.prototype.onFileChosen=function(t){var e=this,i=this.getUniqueFileUploadInstanceId(t),n=this.nativeFileInput;if(n){var o=n.nativeElement.files[0];this.fileUploadersInUse.push(i),this.fileUploadAdapter.uploadFile(o,t.participant.id).subscribe((function(o){e.clearInUseFileUploader(i),o.fromId=e.userId,t.messages.push(o),e.onMessageSent.emit(o),e.scrollChatWindow(t,I.Bottom),n.nativeElement.value=""}),(function(t){e.clearInUseFileUploader(i),n.nativeElement.value=""}))}},c([i.Input()],e.prototype,"fileUploadAdapter",void 0),c([i.Input()],e.prototype,"window",void 0),c([i.Input()],e.prototype,"userId",void 0),c([i.Input()],e.prototype,"localization",void 0),c([i.Input()],e.prototype,"showOptions",void 0),c([i.Input()],e.prototype,"emojisEnabled",void 0),c([i.Input()],e.prototype,"linkfyEnabled",void 0),c([i.Input()],e.prototype,"showMessageDate",void 0),c([i.Input()],e.prototype,"messageDatePipeFormat",void 0),c([i.Input()],e.prototype,"hasPagedHistory",void 0),c([i.Output()],e.prototype,"onChatWindowClosed",void 0),c([i.Output()],e.prototype,"onMessagesSeen",void 0),c([i.Output()],e.prototype,"onMessageSent",void 0),c([i.Output()],e.prototype,"onTabTriggered",void 0),c([i.Output()],e.prototype,"onOptionTriggered",void 0),c([i.Output()],e.prototype,"onLoadHistoryTriggered",void 0),c([i.ViewChild("chatMessages")],e.prototype,"chatMessages",void 0),c([i.ViewChild("nativeFileInput")],e.prototype,"nativeFileInput",void 0),c([i.ViewChild("chatWindowInput")],e.prototype,"chatWindowInput",void 0),e=c([i.Component({selector:"ng-chat-window",template:'<ng-container *ngIf="window && window.isCollapsed">\n\t<div class="ng-chat-title secondary-background">\n\t\t<div class="ng-chat-title-visibility-toggle-area" (click)="onChatWindowClicked(window)">\n\t\t\t<strong title="{{window.participant.displayName}}">\n\t\t\t\t{{window.participant.displayName}}\n\t\t\t</strong>\n\t\t\t<span [ngClass]="{\'ng-chat-participant-status\': true, \'online\': window.participant.status == ChatParticipantStatus.Online, \'busy\': window.participant.status == ChatParticipantStatus.Busy, \'away\': window.participant.status == ChatParticipantStatus.Away, \'offline\': window.participant.status == ChatParticipantStatus.Offline}" title="{{chatParticipantStatusDescriptor(window.participant.status, localization)}}"></span>\n\t\t\t<span *ngIf="unreadMessagesTotal(window).length > 0" class="ng-chat-unread-messages-count unread-messages-counter-container primary-text">{{unreadMessagesTotal(window)}}</span>\n\t\t</div>\n\t\t<a href="javascript:void(0);" class="ng-chat-close primary-text" (click)="onCloseChatWindow()">X</a>\n\t</div>\n</ng-container>\n<ng-container *ngIf="window && !window.isCollapsed">\n\t<div class="ng-chat-title secondary-background">\n\t\t<div class="ng-chat-title-visibility-toggle-area" (click)="onChatWindowClicked(window)">\n\t\t\t<strong title="{{window.participant.displayName}}">\n\t\t\t\t{{window.participant.displayName}}\n\t\t\t</strong>\n\t\t\t<span [ngClass]="{\'ng-chat-participant-status\': true, \'online\': window.participant.status == ChatParticipantStatus.Online, \'busy\': window.participant.status == ChatParticipantStatus.Busy, \'away\': window.participant.status == ChatParticipantStatus.Away, \'offline\': window.participant.status == ChatParticipantStatus.Offline}" title="{{chatParticipantStatusDescriptor(window.participant.status, localization)}}"></span>\n\t\t\t<span *ngIf="unreadMessagesTotal(window).length > 0" class="ng-chat-unread-messages-count unread-messages-counter-container primary-text">{{unreadMessagesTotal(window)}}</span>\n\t\t</div>\n\t\t<a href="javascript:void(0);" class="ng-chat-close primary-text" (click)="onCloseChatWindow()">X</a>\n\t\t<ng-chat-options [ngClass]="\'ng-chat-options-container\'" [options]="defaultWindowOptions(window)" (activeOptionTrackerChange)="activeOptionTrackerChange($event)"></ng-chat-options>\n\t</div>\n\t<div #chatMessages class="ng-chat-messages primary-background">\n\t\t<div *ngIf="window.isLoadingHistory" class="ng-chat-loading-wrapper">\n\t\t\t<div class="loader">Loading history...</div>\n\t\t</div>\n\t\t<div *ngIf="hasPagedHistory && window.hasMoreMessages && !window.isLoadingHistory" class="ng-chat-load-history">\n\t\t\t<a class="load-history-action" (click)="fetchMessageHistory(window)">{{localization.loadMessageHistoryPlaceholder}}</a>\n\t\t</div>\n\n\t\t<div *ngFor="let message of window.messages; let i = index" [ngClass]="{\'ng-chat-message\': true, \'ng-chat-message-received\': message.fromId != userId}">\n\t\t\t<ng-container *ngIf="isAvatarVisible(window, message, i)">\n\t\t\t\t<div *ngIf="!getChatWindowAvatar(window.participant, message) && !getChatWindowAvatarSrc(window.participant, message)" class="icon-wrapper">\n\t\t\t\t\t<i class="user-icon"></i>\n\t\t\t\t</div>\n\t\t\t\t<img *ngIf="getChatWindowAvatar(window.participant, message)" alt="" class="avatar" height="30" width="30" [src]="getChatWindowAvatar(window.participant, message) | sanitize" />\n\t\t\t\t<img *ngIf="getChatWindowAvatarSrc(window.participant, message)" alt="" class="avatar avatarSrc" height="30" width="30" [src]="getChatWindowAvatarSrc(window.participant, message) | secure | async" />\n\t\t\t\t<span *ngIf="window.participant.participantType == ChatParticipantType.Group" class="ng-chat-participant-name">{{window.participant | groupMessageDisplayName:message}}</span>\n\t\t\t</ng-container>\n\t\t\t<ng-container [ngSwitch]="message.type">\n\t\t\t\t<div *ngSwitchCase="MessageType.Text" [ngClass]="{\'sent-chat-message-container\': message.fromId == userId, \'received-chat-message-container\': message.fromId != userId}">\n          <span [innerHtml]="message.message | emojify:emojisEnabled | linkfy:linkfyEnabled"></span>\n\t\t\t\t\t<span *ngIf="showMessageDate && message.dateSent" class="message-sent-date">{{message.dateSent | date:messageDatePipeFormat}}</span>\n\t\t\t\t</div>\n        <div *ngSwitchCase="MessageType.Image" [ngClass]="{\'sent-chat-message-container\': message.fromId == userId, \'received-chat-message-container\': message.fromId != userId}">\n\n          <img src="{{message.message}}" class="image-message" />\n\n\t\t\t\t\t<span *ngIf="showMessageDate && message.dateSent" class="message-sent-date">{{message.dateSent | date:messageDatePipeFormat}}</span>\n\t\t\t\t</div>\n\t\t\t\t<div *ngSwitchCase="MessageType.File" [ngClass]="{\'file-message-container\': true, \'received\': message.fromId != userId}">\n\t\t\t\t\t<div class="file-message-icon-container">\n\t\t\t\t\t\t<i class="paperclip-icon"></i>\n\t\t\t\t\t</div>\n\t\t\t\t\t<a class="file-details" [attr.href]="message.downloadUrl" target="_blank" rel="noopener noreferrer" (click)="this.markMessagesAsRead([message])" download>\n\t\t\t\t\t\t<span class="file-message-title" [attr.title]="message.message">{{message.message}}</span>\n\t\t\t\t\t\t<span *ngIf="message.fileSizeInBytes"  class="file-message-size">{{message.fileSizeInBytes}} Bytes</span>\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t</ng-container>\n\t\t</div>\n\t</div>\n\n\t<div class="ng-chat-footer primary-outline-color primary-background">\n\t\t<input #chatWindowInput\n\t\t\ttype="text"\n\t\t\t[ngModel]="window.newMessage | emojify:emojisEnabled"\n\t\t\t(ngModelChange)="window.newMessage=$event"\n\t\t\t[placeholder]="localization.messagePlaceholder"\n\t\t\t[ngClass]="{\'chat-window-input\': true, \'has-side-action\': fileUploadAdapter}"\n\t\t\t(keydown)="onChatInputTyped($event, window)"\n\t\t\t(blur)="toggleWindowFocus(window)"\n\t\t\t(focus)="toggleWindowFocus(window)"/>\n\n\t\t\x3c!-- File Upload --\x3e\n\t\t<ng-container *ngIf="fileUploadAdapter">\n\t\t\t<a *ngIf="!isUploadingFile(window)" class="btn-add-file" (click)="triggerNativeFileUpload(window)">\n\t\t\t\t<i class="upload-icon"></i>\n\t\t\t</a>\n\t\t\t<input\n\t\t\t\ttype="file"\n\t\t\t\t#nativeFileInput\n\t\t\t\tstyle="display: none;"\n\t\t\t\t[attr.id]="getUniqueFileUploadInstanceId(window)"\n\t\t\t\t(change)="onFileChosen(window)" />\n\t\t\t<div *ngIf="isUploadingFile(window)" class="loader"></div>\n\t\t</ng-container>\n\t</div>\n</ng-container>\n',encapsulation:i.ViewEncapsulation.None,styles:[".ng-chat-window{right:260px;height:360px;z-index:999;bottom:0;width:300px;position:fixed;border-width:1px;border-style:solid;border-bottom:0;box-shadow:0 4px 8px rgba(0,0,0,.25)}.ng-chat-window-collapsed{height:30px!important}.ng-chat-window .ng-chat-footer{box-sizing:border-box;padding:0;display:block;height:calc(10%);width:100%;border:none;border-top:1px solid transparent;border-color:inherit}.ng-chat-window .ng-chat-footer>input{font-size:.8em;box-sizing:border-box;padding:0 5px;display:block;height:100%;width:100%;border:none}.ng-chat-window .ng-chat-footer>input.has-side-action{width:calc(100% - 30px)}.ng-chat-window .ng-chat-footer .btn-add-file{position:absolute;right:5px;bottom:7px;height:20px;width:20px;cursor:pointer}.ng-chat-window .ng-chat-footer .loader{position:absolute;right:14px;bottom:8px}.ng-chat-window .ng-chat-load-history{height:30px;text-align:center;font-size:.8em}.ng-chat-window .ng-chat-load-history>a{border-radius:15px;cursor:pointer;padding:5px 10px}.ng-chat-window .ng-chat-messages{padding:10px;width:100%;height:calc(90% - 30px);box-sizing:border-box;position:relative;overflow:auto}.ng-chat-window .ng-chat-messages .ng-chat-message{clear:both}.ng-chat-window .ng-chat-messages .ng-chat-message>.icon-wrapper,.ng-chat-window .ng-chat-messages .ng-chat-message>img.avatar{position:absolute;left:10px;border-radius:25px}.ng-chat-window .ng-chat-messages .ng-chat-message .ng-chat-participant-name{display:inline-block;margin-left:40px;padding-bottom:5px;font-weight:700;font-size:.8em;text-overflow:ellipsis;max-width:180px}.ng-chat-window .ng-chat-messages .ng-chat-message>.icon-wrapper{background-color:#bababa;overflow:hidden;width:30px;height:30px;padding:0}.ng-chat-window .ng-chat-messages .ng-chat-message>.icon-wrapper>i{color:#fff;transform:scale(.7)}.ng-chat-window .ng-chat-messages .ng-chat-message .message-sent-date{font-size:.8em;display:block;text-align:right;margin-top:5px}.ng-chat-window .ng-chat-messages .ng-chat-message>div{float:right;width:182px;padding:10px;border-radius:5px;margin-top:0;margin-bottom:5px;font-size:.9em;word-wrap:break-word}.ng-chat-window .ng-chat-messages .ng-chat-message.ng-chat-message-received>div.received-chat-message-container{float:left;margin-left:40px;padding-top:7px;padding-bottom:7px;border-style:solid;border-width:3px;margin-top:0;margin-bottom:5px}.ng-chat-window .ng-chat-messages .ng-chat-message .file-message-container{float:right;width:202px;border-style:solid;border-width:3px;border-radius:5px;overflow:hidden;margin-bottom:5px;display:block;text-decoration:none;font-size:.9em;padding:0;box-sizing:border-box}.ng-chat-window .ng-chat-messages .ng-chat-message .file-message-container.received{float:left;margin-left:40px;width:208px}.ng-chat-window .ng-chat-messages .ng-chat-message .file-message-container>.file-message-icon-container{width:20px;height:35px;padding:10px 5px;float:left}.ng-chat-window .ng-chat-messages .ng-chat-message .file-message-container>.file-message-icon-container i{margin-top:8px}.ng-chat-window .ng-chat-messages .ng-chat-message .file-message-container>.file-details{float:left;padding:10px;width:calc(100% - 60px);color:currentColor;text-decoration:none}.ng-chat-window .ng-chat-messages .ng-chat-message .file-message-container>.file-details:hover{text-decoration:underline}.ng-chat-window .ng-chat-messages .ng-chat-message .file-message-container>.file-details span{display:block;width:100%;text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.ng-chat-window .ng-chat-messages .ng-chat-message .file-message-container>.file-details .file-message-title{font-weight:700}.ng-chat-window .ng-chat-messages .ng-chat-message .file-message-container>.file-details .file-message-size{font-size:.8em;margin-top:5px}.ng-chat-window .image-message{width:100%;height:auto}@media only screen and (max-width:581px){.ng-chat-window{position:initial}}"]})],e)}(),H=function(){function t(){}return t=c([i.NgModule({imports:[e.CommonModule,n.FormsModule,o.HttpClientModule],declarations:[F,M,W,S,A,E,U,D,N],exports:[F]})],t)}();t.ChatAdapter=g,t.Group=P,t.Message=m,t.NgChatModule=H,t.PagedHistoryChatAdapter=C,t.ParticipantMetadata=b,t.ParticipantResponse=v,t.User=y,t.Window=x,t.ɵa=F,t.ɵb=M,t.ɵc=W,t.ɵd=S,t.ɵe=A,t.ɵf=E,t.ɵg=U,t.ɵh=D,t.ɵi=N,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=ng-chat.umd.min.js.map